module.exports=[11776,71370,e=>{"use strict";var t=e.i(44738);let n={free:20,pro:-1};async function r(e){let r=await (0,t.createServerClient)(),{data:i}=await r.from("user_subscriptions").select("plan_type, status").eq("user_id",e).single(),o=i?.status==="active"&&i?.plan_type==="pro"?"pro":"free",a=n[o];if(-1===a)return{allowed:!0,remaining:-1,limit:-1,resetAt:new Date(Date.now()+864e5),planTier:o};let{data:s}=await r.from("atlas_query_log").select("id",{count:"exact",head:!0}).eq("user_id",e).gte("created_at",new Date(Date.now()-864e5).toISOString()),l=Math.max(0,a-(s||0));return{allowed:l>0,remaining:l,limit:a,resetAt:new Date(Date.now()+864e5),planTier:o}}async function i(e,n,r,i){let o=await (0,t.createServerClient)();await o.from("atlas_query_log").insert({user_id:e,query_text:n,response_text:r,mode:i})}async function o(e,n,r){let i=await (0,t.createServerClient)(),{data:o}=await i.from("atlas_user_state").select("*").eq("user_id",e).single(),a=[n,...o?.last_queries||[]].slice(0,10),s=o?.emotional_tags||[];r&&!s.includes(r)&&s.push(r),o?await i.from("atlas_user_state").update({last_queries:a,emotional_tags:s.slice(0,20),updated_at:new Date().toISOString()}).eq("user_id",e):await i.from("atlas_user_state").insert({user_id:e,last_queries:a,emotional_tags:r?[r]:[]})}e.s(["checkAtlasRateLimit",()=>r,"logAtlasQuery",()=>i,"updateAtlasMemory",()=>o],11776);var a=e.i(10955),s=e.i(3282),l=e.i(41288),u=e.i(79471),d=e.i(44148);function p(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function c(e){return Object.fromEntries([...e.headers])}var m=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let i=()=>{let e=n.length,r=Array(t);for(let i=0;i<t;i++)r[i]=n[Math.random()*e|0];return r.join("")};if(null==e)return i;if(n.includes(r))throw new a.InvalidArgumentError({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${i()}`})();function g(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var h=["fetch failed","failed to fetch"];function y(e,...t){let n=new Headers(function(e){if(null==e)return{};let t={};if(e instanceof Headers)e.forEach((e,n)=>{t[n.toLowerCase()]=e});else for(let[n,r]of(Array.isArray(e)||(e=Object.entries(e)),e))null!=r&&(t[n.toLowerCase()]=r);return t}(e)),r=n.get("user-agent")||"";return n.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}var f=/"__proto__"\s*:/,z=/"constructor"\s*:/;function _(e){let t=JSON.parse(e);return null===t||"object"!=typeof t||!1===f.test(e)&&!1===z.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let n of(t=[],e)){if(Object.prototype.hasOwnProperty.call(n,"__proto__")||Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in n){let r=n[e];r&&"object"==typeof r&&t.push(r)}}}return e}(t)}function b(e){let{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch(t){return _(e)}try{return _(e)}finally{Error.stackTraceLimit=t}}var v=Symbol.for("vercel.ai.validator");function w(e){let t;return()=>(null==t&&(t=e()),t)}async function k({value:e,schema:t}){let n=await x({value:e,schema:t});if(!n.success)throw a.TypeValidationError.wrap({value:e,cause:n.error});return n.value}async function x({value:e,schema:t}){var n;let r="object"==typeof t&&null!==t&&v in t&&!0===t[v]&&"validate"in t?t:"function"==typeof t?t():(n=t,{[v]:!0,validate:async e=>{let t=await n["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new a.TypeValidationError({value:e,cause:t.issues})}}});try{if(null==r.validate)return{success:!0,value:e,rawValue:e};let t=await r.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:a.TypeValidationError.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:a.TypeValidationError.wrap({value:e,cause:t}),rawValue:e}}}async function j({text:e,schema:t}){try{let n=b(e);if(null==t)return n;return k({value:n,schema:t})}catch(t){if(a.JSONParseError.isInstance(t)||a.TypeValidationError.isInstance(t))throw t;throw new a.JSONParseError({text:e,cause:t})}}async function I({text:e,schema:t}){try{let n=b(e);if(null==t)return{success:!0,value:n,rawValue:n};return await x({value:n,schema:t})}catch(t){return{success:!1,error:a.JSONParseError.isInstance(t)?t:new a.JSONParseError({text:e,cause:t}),rawValue:void 0}}}function P(e){try{return b(e),!0}catch(e){return!1}}async function T({provider:e,providerOptions:t,schema:n}){if((null==t?void 0:t[e])==null)return;let r=await x({value:t[e],schema:n});if(!r.success)throw new a.InvalidArgumentError({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var S=()=>globalThis.fetch,E=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:o,fetch:a})=>q({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:o,fetch:a}),C=async({url:e,headers:t,formData:n,failedResponseHandler:r,successfulResponseHandler:i,abortSignal:o,fetch:a})=>q({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:r,successfulResponseHandler:i,abortSignal:o,fetch:a}),q=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:i,abortSignal:o,fetch:s=S()})=>{try{let l=await s(e,{method:"POST",headers:y(t,"ai-sdk/provider-utils/3.0.19",function(e=globalThis){var t,n,r;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(r=null==(n=e.process)?void 0:n.versions)?void 0:r.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}()),body:n.content,signal:o}),u=c(l);if(!l.ok){let t;try{t=await i({response:l,url:e,requestBodyValues:n.values})}catch(t){if(g(t)||a.APICallError.isInstance(t))throw t;throw new a.APICallError({message:"Failed to process error response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}throw t.value}try{return await r({response:l,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(g(t)||a.APICallError.isInstance(t)))throw t;throw new a.APICallError({message:"Failed to process successful response",cause:t,statusCode:l.status,url:e,responseHeaders:u,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(g(e))return e;if(e instanceof TypeError&&h.includes(e.message.toLowerCase())){let r=e.cause;if(null!=r)return new a.APICallError({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}};function A({id:e,name:t,inputSchema:n,outputSchema:r}){return({execute:i,toModelOutput:o,onInputStart:a,onInputDelta:s,onInputAvailable:l,...u})=>({type:"provider-defined",id:e,name:t,args:u,inputSchema:n,outputSchema:r,execute:i,toModelOutput:o,onInputStart:a,onInputDelta:s,onInputAvailable:l})}var $=e=>async({response:t})=>{let n=c(t);if(null==t.body)throw new a.EmptyResponseBodyError({});return{responseHeaders:n,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new s.EventSourceParserStream).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await I({text:e,schema:t}))}}))}({stream:t.body,schema:e})}},N=e=>async({response:t,url:n,requestBodyValues:r})=>{let i=await t.text(),o=await I({text:i,schema:e}),s=c(t);if(!o.success)throw new a.APICallError({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:i,url:n,requestBodyValues:r});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},Z=Symbol("Let zodToJsonSchema decide on which parser to use"),O={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function F(e,t){return eo(e.type._def,t)}var R=void 0,M=/^[cC][^\s-]{8,}$/,U=/^[0-9a-z]+$/,K=/^[0-9A-HJKMNP-TV-Z]{26}$/,L=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,V=()=>(void 0===R&&(R=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),R),D=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,B=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,J=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,W=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,H=/^[a-zA-Z0-9_-]{21}$/,G=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function Y(e,t){let n={type:"string"};if(e.checks)for(let r of e.checks)switch(r.kind){case"min":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value;break;case"max":n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":ee(n,"email",r.message,t);break;case"format:idn-email":ee(n,"idn-email",r.message,t);break;case"pattern:zod":et(n,L,r.message,t)}break;case"url":ee(n,"uri",r.message,t);break;case"uuid":ee(n,"uuid",r.message,t);break;case"regex":et(n,r.regex,r.message,t);break;case"cuid":et(n,M,r.message,t);break;case"cuid2":et(n,U,r.message,t);break;case"startsWith":et(n,RegExp(`^${Q(r.value,t)}`),r.message,t);break;case"endsWith":et(n,RegExp(`${Q(r.value,t)}$`),r.message,t);break;case"datetime":ee(n,"date-time",r.message,t);break;case"date":ee(n,"date",r.message,t);break;case"time":ee(n,"time",r.message,t);break;case"duration":ee(n,"duration",r.message,t);break;case"length":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value;break;case"includes":et(n,RegExp(Q(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&ee(n,"ipv4",r.message,t),"v4"!==r.version&&ee(n,"ipv6",r.message,t);break;case"base64url":et(n,W,r.message,t);break;case"jwt":et(n,G,r.message,t);break;case"cidr":"v6"!==r.version&&et(n,D,r.message,t),"v4"!==r.version&&et(n,B,r.message,t);break;case"emoji":et(n,V(),r.message,t);break;case"ulid":et(n,K,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":ee(n,"binary",r.message,t);break;case"contentEncoding:base64":n.contentEncoding="base64";break;case"pattern:zod":et(n,J,r.message,t)}break;case"nanoid":et(n,H,r.message,t)}return n}function Q(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)X.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}var X=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ee(e,t,n,r){var i;e.format||(null==(i=e.anyOf)?void 0:i.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function et(e,t,n,r){var i;e.pattern||(null==(i=e.allOf)?void 0:i.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:en(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=en(t,r)}function en(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},i=r.i?e.source.toLowerCase():e.source,o="",a=!1,s=!1,l=!1;for(let e=0;e<i.length;e++){if(a){o+=i[e],a=!1;continue}if(r.i){if(s){if(i[e].match(/[a-z]/)){l?(o+=i[e],o+=`${i[e-2]}-${i[e]}`.toUpperCase(),l=!1):"-"===i[e+1]&&(null==(n=i[e+2])?void 0:n.match(/[a-z]/))?(o+=i[e],l=!0):o+=`${i[e]}${i[e].toUpperCase()}`;continue}}else if(i[e].match(/[a-z]/)){o+=`[${i[e]}${i[e].toUpperCase()}]`;continue}}if(r.m){if("^"===i[e]){o+=`(^|(?<=[\r
]))`;continue}else if("$"===i[e]){o+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===i[e]){o+=s?`${i[e]}\r
`:`[${i[e]}\r
]`;continue}o+=i[e],"\\"===i[e]?a=!0:s&&"]"===i[e]?s=!1:s||"["!==i[e]||(s=!0)}try{new RegExp(o)}catch(n){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function er(e,t){var n,r,i,o,a,s;let l={type:"object",additionalProperties:null!=(n=eo(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?n:t.allowedAdditionalProperties};if((null==(r=e.keyType)?void 0:r._def.typeName)===d.ZodFirstPartyTypeKind.ZodString&&(null==(i=e.keyType._def.checks)?void 0:i.length)){let{type:n,...r}=Y(e.keyType._def,t);return{...l,propertyNames:r}}if((null==(o=e.keyType)?void 0:o._def.typeName)===d.ZodFirstPartyTypeKind.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(a=e.keyType)?void 0:a._def.typeName)===d.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===d.ZodFirstPartyTypeKind.ZodString&&(null==(s=e.keyType._def.type._def.checks)?void 0:s.length)){let{type:n,...r}=F(e.keyType._def,t);return{...l,propertyNames:r}}return l}var ei={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function eo(e,t,n=!1){var r;let i=t.seen.get(e);if(t.override){let o=null==(r=t.override)?void 0:r.call(t,e,t,i,n);if(o!==Z)return o}if(i&&!n){let e=ea(i,t);if(void 0!==e)return e}let o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);let a=((e,t,n)=>{var r,i,o,a,s,l;switch(t){case d.ZodFirstPartyTypeKind.ZodString:return Y(e,n);case d.ZodFirstPartyTypeKind.ZodNumber:let u={type:"number"};if(!e.checks)return u;for(let t of e.checks)switch(t.kind){case"int":u.type="integer";break;case"min":t.inclusive?u.minimum=t.value:u.exclusiveMinimum=t.value;break;case"max":t.inclusive?u.maximum=t.value:u.exclusiveMaximum=t.value;break;case"multipleOf":u.multipleOf=t.value}return u;case d.ZodFirstPartyTypeKind.ZodObject:return function(e,t){let n={type:"object",properties:{}},r=[],i=e.shape();for(let e in i){let o=i[e];if(void 0===o||void 0===o._def)continue;let a=function(e){try{return e.isOptional()}catch(e){return!0}}(o),s=eo(o._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==s&&(n.properties[e]=s,a||r.push(e))}r.length&&(n.required=r);let o=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return eo(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==o&&(n.additionalProperties=o),n}(e,n);case d.ZodFirstPartyTypeKind.ZodBigInt:let p={type:"integer",format:"int64"};if(!e.checks)return p;for(let t of e.checks)switch(t.kind){case"min":t.inclusive?p.minimum=t.value:p.exclusiveMinimum=t.value;break;case"max":t.inclusive?p.maximum=t.value:p.exclusiveMaximum=t.value;break;case"multipleOf":p.multipleOf=t.value}return p;case d.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case d.ZodFirstPartyTypeKind.ZodDate:return function e(t,n,r){let i=null!=r?r:n.dateStrategy;if(Array.isArray(i))return{anyOf:i.map((r,i)=>e(t,n,r))};switch(i){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var o=t;let a={type:"integer",format:"unix-time"};for(let e of o.checks)switch(e.kind){case"min":a.minimum=e.value;break;case"max":a.maximum=e.value}return a}}(e,n);case d.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case d.ZodFirstPartyTypeKind.ZodNull:return{type:"null"};case d.ZodFirstPartyTypeKind.ZodArray:let c;return c={type:"array"},(null==(o=e.type)?void 0:o._def)&&(null==(s=null==(a=e.type)?void 0:a._def)?void 0:s.typeName)!==d.ZodFirstPartyTypeKind.ZodAny&&(c.items=eo(e.type._def,{...n,currentPath:[...n.currentPath,"items"]})),e.minLength&&(c.minItems=e.minLength.value),e.maxLength&&(c.maxItems=e.maxLength.value),e.exactLength&&(c.minItems=e.exactLength.value,c.maxItems=e.exactLength.value),c;case d.ZodFirstPartyTypeKind.ZodUnion:case d.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:let m,g=e.options instanceof Map?Array.from(e.options.values()):e.options;if(g.every(e=>e._def.typeName in ei&&(!e._def.checks||!e._def.checks.length))){let e=g.reduce((e,t)=>{let n=ei[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(g.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=g.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===g.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:g.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(g.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:g.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return r=e,i=n,(m=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((e,t)=>eo(e._def,{...i,currentPath:[...i.currentPath,"anyOf",`${t}`]})).filter(e=>!!e&&(!i.strictUnions||"object"==typeof e&&Object.keys(e).length>0))).length?{anyOf:m}:void 0;case d.ZodFirstPartyTypeKind.ZodIntersection:let h,y;return h=[eo(e.left._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),eo(e.right._def,{...n,currentPath:[...n.currentPath,"allOf","1"]})].filter(e=>!!e),y=[],h.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)y.push(...e.allOf);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:n,...r}=e;t=r}y.push(t)}}),y.length?{allOf:y}:void 0;case d.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>eo(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:eo(e.rest._def,{...n,currentPath:[...n.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>eo(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case d.ZodFirstPartyTypeKind.ZodRecord:return er(e,n);case d.ZodFirstPartyTypeKind.ZodLiteral:let f;return"bigint"!=(f=typeof e.value)&&"number"!==f&&"boolean"!==f&&"string"!==f?{type:Array.isArray(e.value)?"array":"object"}:{type:"bigint"===f?"integer":f,const:e.value};case d.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(e.values)};case d.ZodFirstPartyTypeKind.ZodNativeEnum:let z,_,b;return z=e.values,{type:1===(b=Array.from(new Set((_=Object.keys(e.values).filter(e=>"number"!=typeof z[z[e]]).map(e=>z[e])).map(e=>typeof e)))).length?"string"===b[0]?"string":"number":["string","number"],enum:_};case d.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[ei[e.innerType._def.typeName],"null"]};let v=eo(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","0"]});return v&&{anyOf:[v,{type:"null"}]};case d.ZodFirstPartyTypeKind.ZodOptional:if(n.currentPath.toString()===(null==(l=n.propertyPath)?void 0:l.toString()))return eo(e.innerType._def,n);let w=eo(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","1"]});return w?{anyOf:[{not:{}},w]}:{};case d.ZodFirstPartyTypeKind.ZodMap:if("record"===n.mapStrategy)return er(e,n);return{type:"array",maxItems:125,items:{type:"array",items:[eo(e.keyType._def,{...n,currentPath:[...n.currentPath,"items","items","0"]})||{},eo(e.valueType._def,{...n,currentPath:[...n.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case d.ZodFirstPartyTypeKind.ZodSet:let k;return k={type:"array",uniqueItems:!0,items:eo(e.valueType._def,{...n,currentPath:[...n.currentPath,"items"]})},e.minSize&&(k.minItems=e.minSize.value),e.maxSize&&(k.maxItems=e.maxSize.value),k;case d.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case d.ZodFirstPartyTypeKind.ZodPromise:return eo(e.type._def,n);case d.ZodFirstPartyTypeKind.ZodNaN:case d.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case d.ZodFirstPartyTypeKind.ZodEffects:return"input"===n.effectStrategy?eo(e.schema._def,n):{};case d.ZodFirstPartyTypeKind.ZodAny:case d.ZodFirstPartyTypeKind.ZodUnknown:return{};case d.ZodFirstPartyTypeKind.ZodDefault:return{...eo(e.innerType._def,n),default:e.defaultValue()};case d.ZodFirstPartyTypeKind.ZodBranded:return F(e,n);case d.ZodFirstPartyTypeKind.ZodReadonly:case d.ZodFirstPartyTypeKind.ZodCatch:return eo(e.innerType._def,n);case d.ZodFirstPartyTypeKind.ZodPipeline:if("input"===n.pipeStrategy)return eo(e.in._def,n);if("output"===n.pipeStrategy)return eo(e.out._def,n);let x=eo(e.in._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),j=eo(e.out._def,{...n,currentPath:[...n.currentPath,"allOf",x?"1":"0"]});return{allOf:[x,j].filter(e=>void 0!==e)};case d.ZodFirstPartyTypeKind.ZodFunction:case d.ZodFirstPartyTypeKind.ZodVoid:case d.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?eo(a(),t):a;if(s&&es(e,t,s),t.postProcess){let n=t.postProcess(s,e,t);return o.jsonSchema=s,n}return o.jsonSchema=s,s}var ea=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:((e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")})(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},es=(e,t,n)=>(e.description&&(n.description=e.description),n);function el(e,t){var n,r;let i;if("_zod"in e){let r;return r=null!=(n=null==t?void 0:t.useReferences)&&n,ep(()=>(function e(t){if("object"===t.type){t.additionalProperties=!1;let n=t.properties;if(null!=n)for(let t in n)n[t]=e(n[t])}return"array"===t.type&&null!=t.items&&(Array.isArray(t.items)?t.items=t.items.map(t=>e(t)):t.items=e(t.items)),t})(u.toJSONSchema(e,{target:"draft-7",io:"input",reused:r?"ref":"inline"})),{validate:async t=>{let n=await l.safeParseAsync(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}return i=null!=(r=null==t?void 0:t.useReferences)&&r,ep(()=>((e,t)=>{var n;let r,i,o=(i=void 0!==(r="string"==typeof t?{...O,name:t}:{...O,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var r;return{...e,[t]:null!=(r=eo(n._def,{...o,currentPath:[...o.basePath,o.definitionPath,t]},!0))?r:{}}},{}):void 0,s="string"==typeof t?t:(null==t?void 0:t.nameStrategy)==="title"||null==t?void 0:t.name,l=null!=(n=eo(e._def,void 0===s?o:{...o,currentPath:[...o.basePath,o.definitionPath,s]},!1))?n:{},u="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==u&&(l.title=u);let d=void 0===s?a?{...l,[o.definitionPath]:a}:l:{$ref:[..."relative"===o.$refStrategy?[]:o.basePath,o.definitionPath,s].join("/"),[o.definitionPath]:{...a,[s]:l}};return d.$schema="http://json-schema.org/draft-07/schema#",d})(e,{$refStrategy:i?"root":"none"}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}var eu=Symbol.for("vercel.ai.schema");function ed(e){let t;return()=>(null==t&&(t=e()),t)}function ep(e,{validate:t}={}){return{[eu]:!0,_type:void 0,[v]:!0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}var{btoa:ec,atob:em}=globalThis;function eg(e){return e instanceof Uint8Array?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return ec(t)}(e):e}var eh=e.i(86946),ey=eh.z.object({error:eh.z.object({message:eh.z.string(),type:eh.z.string().nullish(),param:eh.z.any().nullish(),code:eh.z.union([eh.z.string(),eh.z.number()]).nullish()})}),ef=(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:i,requestBodyValues:o})=>{let s=await r.text(),l=c(r);if(""===s.trim())return{responseHeaders:l,value:new a.APICallError({message:r.statusText,url:i,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,isRetryable:null==n?void 0:n(r)})};try{let u=await j({text:s,schema:e});return{responseHeaders:l,value:new a.APICallError({message:t(u),url:i,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,data:u,isRetryable:null==n?void 0:n(r,u)})}}catch(e){return{responseHeaders:l,value:new a.APICallError({message:r.statusText,url:i,requestBodyValues:o,statusCode:r.status,responseHeaders:l,responseBody:s,isRetryable:null==n?void 0:n(r)})}}})({errorSchema:ey,errorToMessage:e=>e.error.message});function ez(e){let t=e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),n=e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini"),r=!(e.startsWith("gpt-3")||e.startsWith("gpt-4")||e.startsWith("chatgpt-4o")||e.startsWith("gpt-5-chat"));return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:r,systemMessageMode:r?"developer":"system",supportsNonReasoningParameters:e.startsWith("gpt-5.1")||e.startsWith("gpt-5.2")}}function e_({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:n?new Date(1e3*n):void 0}}function eb(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var ev=w(()=>el(eh.z.object({id:eh.z.string().nullish(),created:eh.z.number().nullish(),model:eh.z.string().nullish(),choices:eh.z.array(eh.z.object({message:eh.z.object({role:eh.z.literal("assistant").nullish(),content:eh.z.string().nullish(),tool_calls:eh.z.array(eh.z.object({id:eh.z.string().nullish(),type:eh.z.literal("function"),function:eh.z.object({name:eh.z.string(),arguments:eh.z.string()})})).nullish(),annotations:eh.z.array(eh.z.object({type:eh.z.literal("url_citation"),url_citation:eh.z.object({start_index:eh.z.number(),end_index:eh.z.number(),url:eh.z.string(),title:eh.z.string()})})).nullish()}),index:eh.z.number(),logprobs:eh.z.object({content:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number(),top_logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number()}))})).nullish()}).nullish(),finish_reason:eh.z.string().nullish()})),usage:eh.z.object({prompt_tokens:eh.z.number().nullish(),completion_tokens:eh.z.number().nullish(),total_tokens:eh.z.number().nullish(),prompt_tokens_details:eh.z.object({cached_tokens:eh.z.number().nullish()}).nullish(),completion_tokens_details:eh.z.object({reasoning_tokens:eh.z.number().nullish(),accepted_prediction_tokens:eh.z.number().nullish(),rejected_prediction_tokens:eh.z.number().nullish()}).nullish()}).nullish()}))),ew=w(()=>el(eh.z.union([eh.z.object({id:eh.z.string().nullish(),created:eh.z.number().nullish(),model:eh.z.string().nullish(),choices:eh.z.array(eh.z.object({delta:eh.z.object({role:eh.z.enum(["assistant"]).nullish(),content:eh.z.string().nullish(),tool_calls:eh.z.array(eh.z.object({index:eh.z.number(),id:eh.z.string().nullish(),type:eh.z.literal("function").nullish(),function:eh.z.object({name:eh.z.string().nullish(),arguments:eh.z.string().nullish()})})).nullish(),annotations:eh.z.array(eh.z.object({type:eh.z.literal("url_citation"),url_citation:eh.z.object({start_index:eh.z.number(),end_index:eh.z.number(),url:eh.z.string(),title:eh.z.string()})})).nullish()}).nullish(),logprobs:eh.z.object({content:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number(),top_logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number()}))})).nullish()}).nullish(),finish_reason:eh.z.string().nullish(),index:eh.z.number()})),usage:eh.z.object({prompt_tokens:eh.z.number().nullish(),completion_tokens:eh.z.number().nullish(),total_tokens:eh.z.number().nullish(),prompt_tokens_details:eh.z.object({cached_tokens:eh.z.number().nullish()}).nullish(),completion_tokens_details:eh.z.object({reasoning_tokens:eh.z.number().nullish(),accepted_prediction_tokens:eh.z.number().nullish(),rejected_prediction_tokens:eh.z.number().nullish()}).nullish()}).nullish()}),ey]))),ek=w(()=>el(eh.z.object({logitBias:eh.z.record(eh.z.coerce.number(),eh.z.number()).optional(),logprobs:eh.z.union([eh.z.boolean(),eh.z.number()]).optional(),parallelToolCalls:eh.z.boolean().optional(),user:eh.z.string().optional(),reasoningEffort:eh.z.enum(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:eh.z.number().optional(),store:eh.z.boolean().optional(),metadata:eh.z.record(eh.z.string().max(64),eh.z.string().max(512)).optional(),prediction:eh.z.record(eh.z.string(),eh.z.any()).optional(),structuredOutputs:eh.z.boolean().optional(),serviceTier:eh.z.enum(["auto","flex","priority","default"]).optional(),strictJsonSchema:eh.z.boolean().optional(),textVerbosity:eh.z.enum(["low","medium","high"]).optional(),promptCacheKey:eh.z.string().optional(),promptCacheRetention:eh.z.enum(["in_memory","24h"]).optional(),safetyIdentifier:eh.z.string().optional()}))),ex=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:o,presencePenalty:s,stopSequences:l,responseFormat:u,seed:d,tools:p,toolChoice:c,providerOptions:m}){var g,h,y,f;let z=[],_=null!=(g=await T({provider:"openai",providerOptions:m,schema:ek}))?g:{},b=null==(h=_.structuredOutputs)||h,v=ez(this.modelId);null!=i&&z.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||b||z.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let{messages:w,warnings:k}=function({prompt:e,systemMessageMode:t="system"}){let n=[],r=[];for(let{role:i,content:o}of e)switch(i){case"system":switch(t){case"system":n.push({role:"system",content:o});break;case"developer":n.push({role:"developer",content:o});break;case"remove":r.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===o.length&&"text"===o[0].type){n.push({role:"user",content:o[0].text});break}n.push({role:"user",content:o.map((e,t)=>{var n,r,i;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${eg(e.data)}`,detail:null==(r=null==(n=e.providerOptions)?void 0:n.openai)?void 0:r.imageDetail}}}if(e.mediaType.startsWith("audio/")){if(e.data instanceof URL)throw new a.UnsupportedFunctionalityError({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:eg(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:eg(e.data),format:"mp3"}};default:throw new a.UnsupportedFunctionalityError({functionality:`audio content parts with media type ${e.mediaType}`})}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new a.UnsupportedFunctionalityError({functionality:"PDF file parts with URLs"});return{type:"file",file:"string"==typeof e.data&&e.data.startsWith("file-")?{file_id:e.data}:{filename:null!=(i=e.filename)?i:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${eg(e.data)}`}}}else throw new a.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e="",t=[];for(let n of o)switch(n.type){case"text":e+=n.text;break;case"tool-call":t.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}})}n.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(let e of o){let t,r=e.output;switch(r.type){case"text":case"error-text":t=r.value;break;case"content":case"json":case"error-json":t=JSON.stringify(r.value)}n.push({role:"tool",tool_call_id:e.toolCallId,content:t})}break;default:throw Error(`Unsupported role: ${i}`)}return{messages:n,warnings:r}}({prompt:e,systemMessageMode:v.systemMessageMode});z.push(...k);let x=null!=(y=_.strictJsonSchema)&&y,j={model:this.modelId,logit_bias:_.logitBias,logprobs:!0===_.logprobs||"number"==typeof _.logprobs||void 0,top_logprobs:"number"==typeof _.logprobs?_.logprobs:"boolean"==typeof _.logprobs&&_.logprobs?0:void 0,user:_.user,parallel_tool_calls:_.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,response_format:(null==u?void 0:u.type)==="json"?b&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,strict:x,name:null!=(f=u.name)?f:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:d,verbosity:_.textVerbosity,max_completion_tokens:_.maxCompletionTokens,store:_.store,metadata:_.metadata,prediction:_.prediction,reasoning_effort:_.reasoningEffort,service_tier:_.serviceTier,prompt_cache_key:_.promptCacheKey,prompt_cache_retention:_.promptCacheRetention,safety_identifier:_.safetyIdentifier,messages:w};v.isReasoningModel?("none"===_.reasoningEffort&&v.supportsNonReasoningParameters||(null!=j.temperature&&(j.temperature=void 0,z.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=j.top_p&&(j.top_p=void 0,z.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=j.logprobs&&(j.logprobs=void 0,z.push({type:"other",message:"logprobs is not supported for reasoning models"}))),null!=j.frequency_penalty&&(j.frequency_penalty=void 0,z.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=j.presence_penalty&&(j.presence_penalty=void 0,z.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=j.logit_bias&&(j.logit_bias=void 0,z.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=j.top_logprobs&&(j.top_logprobs=void 0,z.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=j.max_tokens&&(null==j.max_completion_tokens&&(j.max_completion_tokens=j.max_tokens),j.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=j.temperature&&(j.temperature=void 0,z.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==_.serviceTier||v.supportsFlexProcessing||(z.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),j.service_tier=void 0),"priority"!==_.serviceTier||v.supportsPriorityProcessing||(z.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),j.service_tier=void 0);let{tools:I,toolChoice:P,toolWarnings:S}=function({tools:e,toolChoice:t,structuredOutputs:n,strictJsonSchema:r}){e=(null==e?void 0:e.length)?e:void 0;let i=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:i};let o=[];for(let t of e)"function"===t.type?o.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:n?r:void 0}}):i.push({type:"unsupported-tool",tool:t});if(null==t)return{tools:o,toolChoice:void 0,toolWarnings:i};let s=t.type;switch(s){case"auto":case"none":case"required":return{tools:o,toolChoice:s,toolWarnings:i};case"tool":return{tools:o,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:i};default:throw new a.UnsupportedFunctionalityError({functionality:`tool choice type: ${s}`})}}({tools:p,toolChoice:c,structuredOutputs:b,strictJsonSchema:x});return{args:{...j,tools:I,tool_choice:P},warnings:[...z,...S]}}async doGenerate(e){var t,n,r,i,o,a,s,l,u,d,c,g,h,y;let{args:f,warnings:z}=await this.getArgs(e),{responseHeaders:_,value:b,rawValue:v}=await E({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:f,failedResponseHandler:ef,successfulResponseHandler:N(ev),abortSignal:e.abortSignal,fetch:this.config.fetch}),w=b.choices[0],k=[],x=w.message.content;for(let e of(null!=x&&x.length>0&&k.push({type:"text",text:x}),null!=(t=w.message.tool_calls)?t:[]))k.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:m(),toolName:e.function.name,input:e.function.arguments});for(let e of null!=(r=w.message.annotations)?r:[])k.push({type:"source",sourceType:"url",id:m(),url:e.url_citation.url,title:e.url_citation.title});let j=null==(i=b.usage)?void 0:i.completion_tokens_details,I=null==(o=b.usage)?void 0:o.prompt_tokens_details,P={openai:{}};return(null==j?void 0:j.accepted_prediction_tokens)!=null&&(P.openai.acceptedPredictionTokens=null==j?void 0:j.accepted_prediction_tokens),(null==j?void 0:j.rejected_prediction_tokens)!=null&&(P.openai.rejectedPredictionTokens=null==j?void 0:j.rejected_prediction_tokens),(null==(a=w.logprobs)?void 0:a.content)!=null&&(P.openai.logprobs=w.logprobs.content),{content:k,finishReason:eb(w.finish_reason),usage:{inputTokens:null!=(l=null==(s=b.usage)?void 0:s.prompt_tokens)?l:void 0,outputTokens:null!=(d=null==(u=b.usage)?void 0:u.completion_tokens)?d:void 0,totalTokens:null!=(g=null==(c=b.usage)?void 0:c.total_tokens)?g:void 0,reasoningTokens:null!=(h=null==j?void 0:j.reasoning_tokens)?h:void 0,cachedInputTokens:null!=(y=null==I?void 0:I.cached_tokens)?y:void 0},request:{body:f},response:{...e_(b),headers:_,body:v},warnings:z,providerMetadata:P}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:o}=await E({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:r,failedResponseHandler:ef,successfulResponseHandler:$(ew),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=[],l="unknown",u={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d=!1,c=!1,g={openai:{}};return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var r,i,o,p,h,y,f,z,_,b,v,w,k,x,j,I,T,S,E,C,q,A,$,N;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){l="error",n.enqueue({type:"error",error:t.error});return}let Z=t.value;if("error"in Z){l="error",n.enqueue({type:"error",error:Z.error});return}!d&&Object.values(e_(Z)).some(Boolean)&&(d=!0,n.enqueue({type:"response-metadata",...e_(Z)})),null!=Z.usage&&(u.inputTokens=null!=(r=Z.usage.prompt_tokens)?r:void 0,u.outputTokens=null!=(i=Z.usage.completion_tokens)?i:void 0,u.totalTokens=null!=(o=Z.usage.total_tokens)?o:void 0,u.reasoningTokens=null!=(h=null==(p=Z.usage.completion_tokens_details)?void 0:p.reasoning_tokens)?h:void 0,u.cachedInputTokens=null!=(f=null==(y=Z.usage.prompt_tokens_details)?void 0:y.cached_tokens)?f:void 0,(null==(z=Z.usage.completion_tokens_details)?void 0:z.accepted_prediction_tokens)!=null&&(g.openai.acceptedPredictionTokens=null==(_=Z.usage.completion_tokens_details)?void 0:_.accepted_prediction_tokens),(null==(b=Z.usage.completion_tokens_details)?void 0:b.rejected_prediction_tokens)!=null&&(g.openai.rejectedPredictionTokens=null==(v=Z.usage.completion_tokens_details)?void 0:v.rejected_prediction_tokens));let O=Z.choices[0];if((null==O?void 0:O.finish_reason)!=null&&(l=eb(O.finish_reason)),(null==(w=null==O?void 0:O.logprobs)?void 0:w.content)!=null&&(g.openai.logprobs=O.logprobs.content),(null==O?void 0:O.delta)==null)return;let F=O.delta;if(null!=F.content&&(c||(n.enqueue({type:"text-start",id:"0"}),c=!0),n.enqueue({type:"text-delta",id:"0",delta:F.content})),null!=F.tool_calls)for(let e of F.tool_calls){let t=e.index;if(null==s[t]){if("function"!==e.type)throw new a.InvalidResponseDataError({data:e,message:"Expected 'function' type."});if(null==e.id)throw new a.InvalidResponseDataError({data:e,message:"Expected 'id' to be a string."});if((null==(k=e.function)?void 0:k.name)==null)throw new a.InvalidResponseDataError({data:e,message:"Expected 'function.name' to be a string."});n.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),s[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(x=e.function.arguments)?x:""},hasFinished:!1};let r=s[t];(null==(j=r.function)?void 0:j.name)!=null&&(null==(I=r.function)?void 0:I.arguments)!=null&&(r.function.arguments.length>0&&n.enqueue({type:"tool-input-delta",id:r.id,delta:r.function.arguments}),P(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(T=r.id)?T:m(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0));continue}let r=s[t];!r.hasFinished&&((null==(S=e.function)?void 0:S.arguments)!=null&&(r.function.arguments+=null!=(C=null==(E=e.function)?void 0:E.arguments)?C:""),n.enqueue({type:"tool-input-delta",id:r.id,delta:null!=(q=e.function.arguments)?q:""}),(null==(A=r.function)?void 0:A.name)!=null&&(null==($=r.function)?void 0:$.arguments)!=null&&P(r.function.arguments)&&(n.enqueue({type:"tool-input-end",id:r.id}),n.enqueue({type:"tool-call",toolCallId:null!=(N=r.id)?N:m(),toolName:r.function.name,input:r.function.arguments}),r.hasFinished=!0))}if(null!=F.annotations)for(let e of F.annotations)n.enqueue({type:"source",sourceType:"url",id:m(),url:e.url_citation.url,title:e.url_citation.title})},flush(e){c&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:l,usage:u,...null!=g?{providerMetadata:g}:{}})}})),request:{body:r},response:{headers:i}}}};function ej({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function eI(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var eP=w(()=>el(eh.z.object({id:eh.z.string().nullish(),created:eh.z.number().nullish(),model:eh.z.string().nullish(),choices:eh.z.array(eh.z.object({text:eh.z.string(),finish_reason:eh.z.string(),logprobs:eh.z.object({tokens:eh.z.array(eh.z.string()),token_logprobs:eh.z.array(eh.z.number()),top_logprobs:eh.z.array(eh.z.record(eh.z.string(),eh.z.number())).nullish()}).nullish()})),usage:eh.z.object({prompt_tokens:eh.z.number(),completion_tokens:eh.z.number(),total_tokens:eh.z.number()}).nullish()}))),eT=w(()=>el(eh.z.union([eh.z.object({id:eh.z.string().nullish(),created:eh.z.number().nullish(),model:eh.z.string().nullish(),choices:eh.z.array(eh.z.object({text:eh.z.string(),finish_reason:eh.z.string().nullish(),index:eh.z.number(),logprobs:eh.z.object({tokens:eh.z.array(eh.z.string()),token_logprobs:eh.z.array(eh.z.number()),top_logprobs:eh.z.array(eh.z.record(eh.z.string(),eh.z.number())).nullish()}).nullish()})),usage:eh.z.object({prompt_tokens:eh.z.number(),completion_tokens:eh.z.number(),total_tokens:eh.z.number()}).nullish()}),ey]))),eS=w(()=>el(eh.z.object({echo:eh.z.boolean().optional(),logitBias:eh.z.record(eh.z.string(),eh.z.number()).optional(),suffix:eh.z.string().optional(),user:eh.z.string().optional(),logprobs:eh.z.union([eh.z.boolean(),eh.z.number()]).optional()}))),eE=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:i,frequencyPenalty:o,presencePenalty:s,stopSequences:l,responseFormat:u,tools:d,toolChoice:p,seed:c,providerOptions:m}){let g=[],h={...await T({provider:"openai",providerOptions:m,schema:eS}),...await T({provider:this.providerOptionsName,providerOptions:m,schema:eS})};null!=i&&g.push({type:"unsupported-setting",setting:"topK"}),(null==d?void 0:d.length)&&g.push({type:"unsupported-setting",setting:"tools"}),null!=p&&g.push({type:"unsupported-setting",setting:"toolChoice"}),null!=u&&"text"!==u.type&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:y,stopSequences:f}=function({prompt:e,user:t="user",assistant:n="assistant"}){let r="";for(let{role:i,content:o}of("system"===e[0].role&&(r+=`${e[0].content}

`,e=e.slice(1)),e))switch(i){case"system":throw new a.InvalidPromptError({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=o.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("");r+=`${t}:
${e}

`;break}case"assistant":{let e=o.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new a.UnsupportedFunctionalityError({functionality:"tool-call messages"})}}).join("");r+=`${n}:
${e}

`;break}case"tool":throw new a.UnsupportedFunctionalityError({functionality:"tool messages"});default:throw Error(`Unsupported role: ${i}`)}return{prompt:r+=`${n}:
`,stopSequences:[`
${t}:`]}}({prompt:e}),z=[...null!=f?f:[],...null!=l?l:[]];return{args:{model:this.modelId,echo:h.echo,logit_bias:h.logitBias,logprobs:(null==h?void 0:h.logprobs)===!0?0:(null==h?void 0:h.logprobs)===!1||null==h?void 0:h.logprobs,suffix:h.suffix,user:h.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,seed:c,prompt:y,stop:z.length>0?z:void 0},warnings:g}}async doGenerate(e){var t,n,r;let{args:i,warnings:o}=await this.getArgs(e),{responseHeaders:a,value:s,rawValue:l}=await E({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:i,failedResponseHandler:ef,successfulResponseHandler:N(eP),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=s.choices[0],d={openai:{}};return null!=u.logprobs&&(d.openai.logprobs=u.logprobs),{content:[{type:"text",text:u.text}],usage:{inputTokens:null==(t=s.usage)?void 0:t.prompt_tokens,outputTokens:null==(n=s.usage)?void 0:n.completion_tokens,totalTokens:null==(r=s.usage)?void 0:r.total_tokens},finishReason:eI(u.finish_reason),request:{body:i},response:{...ej(s),headers:a,body:l},providerMetadata:d,warnings:o}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:o}=await E({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:r,failedResponseHandler:ef,successfulResponseHandler:$(eT),abortSignal:e.abortSignal,fetch:this.config.fetch}),a="unknown",s={openai:{}},l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},u=!0;return{stream:o.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success){a="error",n.enqueue({type:"error",error:t.error});return}let r=t.value;if("error"in r){a="error",n.enqueue({type:"error",error:r.error});return}u&&(u=!1,n.enqueue({type:"response-metadata",...ej(r)}),n.enqueue({type:"text-start",id:"0"})),null!=r.usage&&(l.inputTokens=r.usage.prompt_tokens,l.outputTokens=r.usage.completion_tokens,l.totalTokens=r.usage.total_tokens);let i=r.choices[0];(null==i?void 0:i.finish_reason)!=null&&(a=eI(i.finish_reason)),(null==i?void 0:i.logprobs)!=null&&(s.openai.logprobs=i.logprobs),(null==i?void 0:i.text)!=null&&i.text.length>0&&n.enqueue({type:"text-delta",id:"0",delta:i.text})},flush(e){u||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:a,providerMetadata:s,usage:l})}})),request:{body:r},response:{headers:i}}}},eC=w(()=>el(eh.z.object({dimensions:eh.z.number().optional(),user:eh.z.string().optional()}))),eq=w(()=>el(eh.z.object({data:eh.z.array(eh.z.object({embedding:eh.z.array(eh.z.number())})),usage:eh.z.object({prompt_tokens:eh.z.number()}).nullish()}))),eA=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:r}){var i;if(e.length>this.maxEmbeddingsPerCall)throw new a.TooManyEmbeddingValuesForCallError({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let o=null!=(i=await T({provider:"openai",providerOptions:r,schema:eC}))?i:{},{responseHeaders:s,value:l,rawValue:u}=await E({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:p(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:o.dimensions,user:o.user},failedResponseHandler:ef,successfulResponseHandler:N(eq),abortSignal:n,fetch:this.config.fetch});return{embeddings:l.data.map(e=>e.embedding),usage:l.usage?{tokens:l.usage.prompt_tokens}:void 0,response:{headers:s,body:u}}}},e$=w(()=>el(eh.z.object({created:eh.z.number().nullish(),data:eh.z.array(eh.z.object({b64_json:eh.z.string(),revised_prompt:eh.z.string().nullish()})),background:eh.z.string().nullish(),output_format:eh.z.string().nullish(),size:eh.z.string().nullish(),quality:eh.z.string().nullish(),usage:eh.z.object({input_tokens:eh.z.number().nullish(),output_tokens:eh.z.number().nullish(),total_tokens:eh.z.number().nullish(),input_tokens_details:eh.z.object({image_tokens:eh.z.number().nullish(),text_tokens:eh.z.number().nullish()}).nullish()}).nullish()}))),eN={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},eZ=new Set(["gpt-image-1","gpt-image-1-mini","gpt-image-1.5"]),eO=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=eN[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:n,aspectRatio:r,seed:i,providerOptions:o,headers:a,abortSignal:s}){var l,u,d,c;let m=[];null!=r&&m.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=i&&m.push({type:"unsupported-setting",setting:"seed"});let g=null!=(d=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?d:new Date,{value:h,responseHeaders:y}=await E({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:p(this.config.headers(),a),body:{model:this.modelId,prompt:e,n:t,size:n,...null!=(c=o.openai)?c:{},...!eZ.has(this.modelId)?{response_format:"b64_json"}:{}},failedResponseHandler:ef,successfulResponseHandler:N(e$),abortSignal:s,fetch:this.config.fetch});return{images:h.data.map(e=>e.b64_json),warnings:m,response:{timestamp:g,modelId:this.modelId,headers:y},providerMetadata:{openai:{images:h.data.map(e=>({...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},...null!=h.created?{created:h.created}:{},...null!=h.size?{size:h.size}:{},...null!=h.quality?{quality:h.quality}:{},...null!=h.background?{background:h.background}:{},...null!=h.output_format?{outputFormat:h.output_format}:{}}))}}}}},eF=ed(()=>el(eh.z.object({code:eh.z.string().nullish(),containerId:eh.z.string()}))),eR=ed(()=>el(eh.z.object({outputs:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("logs"),logs:eh.z.string()}),eh.z.object({type:eh.z.literal("image"),url:eh.z.string()})])).nullish()}))),eM=ed(()=>el(eh.z.object({container:eh.z.union([eh.z.string(),eh.z.object({fileIds:eh.z.array(eh.z.string()).optional()})]).optional()}))),eU=A({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:eF,outputSchema:eR}),eK=eh.z.object({key:eh.z.string(),type:eh.z.enum(["eq","ne","gt","gte","lt","lte","in","nin"]),value:eh.z.union([eh.z.string(),eh.z.number(),eh.z.boolean(),eh.z.array(eh.z.string())])}),eL=eh.z.object({type:eh.z.enum(["and","or"]),filters:eh.z.array(eh.z.union([eK,eh.z.lazy(()=>eL)]))}),eV=ed(()=>el(eh.z.object({vectorStoreIds:eh.z.array(eh.z.string()),maxNumResults:eh.z.number().optional(),ranking:eh.z.object({ranker:eh.z.string().optional(),scoreThreshold:eh.z.number().optional()}).optional(),filters:eh.z.union([eK,eL]).optional()}))),eD=ed(()=>el(eh.z.object({queries:eh.z.array(eh.z.string()),results:eh.z.array(eh.z.object({attributes:eh.z.record(eh.z.string(),eh.z.unknown()),fileId:eh.z.string(),filename:eh.z.string(),score:eh.z.number(),text:eh.z.string()})).nullable()}))),eB=A({id:"openai.file_search",name:"file_search",inputSchema:eh.z.object({}),outputSchema:eD}),eJ=ed(()=>el(eh.z.object({background:eh.z.enum(["auto","opaque","transparent"]).optional(),inputFidelity:eh.z.enum(["low","high"]).optional(),inputImageMask:eh.z.object({fileId:eh.z.string().optional(),imageUrl:eh.z.string().optional()}).optional(),model:eh.z.string().optional(),moderation:eh.z.enum(["auto"]).optional(),outputCompression:eh.z.number().int().min(0).max(100).optional(),outputFormat:eh.z.enum(["png","jpeg","webp"]).optional(),partialImages:eh.z.number().int().min(0).max(3).optional(),quality:eh.z.enum(["auto","low","medium","high"]).optional(),size:eh.z.enum(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),eW=A({id:"openai.image_generation",name:"image_generation",inputSchema:ed(()=>el(eh.z.object({}))),outputSchema:ed(()=>el(eh.z.object({result:eh.z.string()})))}),eH=ed(()=>el(eh.z.object({action:eh.z.object({type:eh.z.literal("exec"),command:eh.z.array(eh.z.string()),timeoutMs:eh.z.number().optional(),user:eh.z.string().optional(),workingDirectory:eh.z.string().optional(),env:eh.z.record(eh.z.string(),eh.z.string()).optional()})}))),eG=ed(()=>el(eh.z.object({output:eh.z.string()}))),eY=A({id:"openai.local_shell",name:"local_shell",inputSchema:eH,outputSchema:eG}),eQ=ed(()=>el(eh.z.object({externalWebAccess:eh.z.boolean().optional(),filters:eh.z.object({allowedDomains:eh.z.array(eh.z.string()).optional()}).optional(),searchContextSize:eh.z.enum(["low","medium","high"]).optional(),userLocation:eh.z.object({type:eh.z.literal("approximate"),country:eh.z.string().optional(),city:eh.z.string().optional(),region:eh.z.string().optional(),timezone:eh.z.string().optional()}).optional()}))),eX=A({id:"openai.web_search",name:"web_search",inputSchema:ed(()=>el(eh.z.object({}))),outputSchema:ed(()=>el(eh.z.object({action:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("search"),query:eh.z.string().optional()}),eh.z.object({type:eh.z.literal("openPage"),url:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("findInPage"),url:eh.z.string().nullish(),pattern:eh.z.string().nullish()})]),sources:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("url"),url:eh.z.string()}),eh.z.object({type:eh.z.literal("api"),name:eh.z.string()})])).optional()})))}),e0=ed(()=>el(eh.z.object({searchContextSize:eh.z.enum(["low","medium","high"]).optional(),userLocation:eh.z.object({type:eh.z.literal("approximate"),country:eh.z.string().optional(),city:eh.z.string().optional(),region:eh.z.string().optional(),timezone:eh.z.string().optional()}).optional()}))),e1={codeInterpreter:(e={})=>eU(e),fileSearch:eB,imageGeneration:(e={})=>eW(e),localShell:eY,webSearchPreview:A({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:ed(()=>el(eh.z.object({}))),outputSchema:ed(()=>el(eh.z.object({action:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("search"),query:eh.z.string().optional()}),eh.z.object({type:eh.z.literal("openPage"),url:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("findInPage"),url:eh.z.string().nullish(),pattern:eh.z.string().nullish()})])})))}),webSearch:(e={})=>eX(e)};function e4(e,t){return!!t&&t.some(t=>e.startsWith(t))}async function e9({prompt:e,systemMessageMode:t,fileIdPrefixes:n,store:r,hasLocalShellTool:i=!1}){var o,s,l,u;let d=[],p=[];for(let{role:c,content:m}of e)switch(c){case"system":switch(t){case"system":d.push({role:"system",content:m});break;case"developer":d.push({role:"developer",content:m});break;case"remove":p.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":d.push({role:"user",content:m.map((e,t)=>{var r,i,o;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",...e.data instanceof URL?{image_url:e.data.toString()}:"string"==typeof e.data&&e4(e.data,n)?{file_id:e.data}:{image_url:`data:${t};base64,${eg(e.data)}`},detail:null==(i=null==(r=e.providerOptions)?void 0:r.openai)?void 0:i.imageDetail}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)return{type:"input_file",file_url:e.data.toString()};return{type:"input_file",..."string"==typeof e.data&&e4(e.data,n)?{file_id:e.data}:{filename:null!=(o=e.filename)?o:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${eg(e.data)}`}}}throw new a.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e={},t={};for(let n of m)switch(n.type){case"text":{let e=null==(s=null==(o=n.providerOptions)?void 0:o.openai)?void 0:s.itemId;if(r&&null!=e){d.push({type:"item_reference",id:e});break}d.push({role:"assistant",content:[{type:"output_text",text:n.text}],id:e});break}case"tool-call":{if(t[n.toolCallId]=n,n.providerExecuted)break;let e=null==(u=null==(l=n.providerOptions)?void 0:l.openai)?void 0:u.itemId;if(r&&null!=e){d.push({type:"item_reference",id:e});break}if(i&&"local_shell"===n.toolName){let t=await k({value:n.input,schema:eH});d.push({type:"local_shell_call",call_id:n.toolCallId,id:e,action:{type:"exec",command:t.action.command,timeout_ms:t.action.timeoutMs,user:t.action.user,working_directory:t.action.workingDirectory,env:t.action.env}});break}d.push({type:"function_call",call_id:n.toolCallId,name:n.toolName,arguments:JSON.stringify(n.input),id:e});break}case"tool-result":r?d.push({type:"item_reference",id:n.toolCallId}):p.push({type:"other",message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case"reasoning":{let t=await T({provider:"openai",providerOptions:n.providerOptions,schema:e2}),i=null==t?void 0:t.itemId;if(null!=i){let o=e[i];if(r)void 0===o&&(d.push({type:"item_reference",id:i}),e[i]={type:"reasoning",id:i,summary:[]});else{let r=[];n.text.length>0?r.push({type:"summary_text",text:n.text}):void 0!==o&&p.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),void 0===o?(e[i]={type:"reasoning",id:i,encrypted_content:null==t?void 0:t.reasoningEncryptedContent,summary:r},d.push(e[i])):(o.summary.push(...r),(null==t?void 0:t.reasoningEncryptedContent)!=null&&(o.encrypted_content=t.reasoningEncryptedContent))}}else p.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`})}}break}case"tool":for(let e of m){let t,n=e.output;if(i&&"local_shell"===e.toolName&&"json"===n.type){let t=await k({value:n.value,schema:eG});d.push({type:"local_shell_call_output",call_id:e.toolCallId,output:t.output});break}switch(n.type){case"text":case"error-text":t=n.value;break;case"json":case"error-json":t=JSON.stringify(n.value);break;case"content":t=n.value.map(e=>{switch(e.type){case"text":return{type:"input_text",text:e.text};case"media":return e.mediaType.startsWith("image/")?{type:"input_image",image_url:`data:${e.mediaType};base64,${e.data}`}:{type:"input_file",filename:"data",file_data:`data:${e.mediaType};base64,${e.data}`}}})}d.push({type:"function_call_output",call_id:e.toolCallId,output:t})}break;default:throw Error(`Unsupported role: ${c}`)}return{input:d,warnings:p}}var e2=eh.z.object({itemId:eh.z.string().nullish(),reasoningEncryptedContent:eh.z.string().nullish()});function e5({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var e3=w(()=>el(eh.z.union([eh.z.object({type:eh.z.literal("response.output_text.delta"),item_id:eh.z.string(),delta:eh.z.string(),logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number(),top_logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number()}))})).nullish()}),eh.z.object({type:eh.z.enum(["response.completed","response.incomplete"]),response:eh.z.object({incomplete_details:eh.z.object({reason:eh.z.string()}).nullish(),usage:eh.z.object({input_tokens:eh.z.number(),input_tokens_details:eh.z.object({cached_tokens:eh.z.number().nullish()}).nullish(),output_tokens:eh.z.number(),output_tokens_details:eh.z.object({reasoning_tokens:eh.z.number().nullish()}).nullish()}),service_tier:eh.z.string().nullish()})}),eh.z.object({type:eh.z.literal("response.created"),response:eh.z.object({id:eh.z.string(),created_at:eh.z.number(),model:eh.z.string(),service_tier:eh.z.string().nullish()})}),eh.z.object({type:eh.z.literal("response.output_item.added"),output_index:eh.z.number(),item:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("message"),id:eh.z.string()}),eh.z.object({type:eh.z.literal("reasoning"),id:eh.z.string(),encrypted_content:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("function_call"),id:eh.z.string(),call_id:eh.z.string(),name:eh.z.string(),arguments:eh.z.string()}),eh.z.object({type:eh.z.literal("web_search_call"),id:eh.z.string(),status:eh.z.string()}),eh.z.object({type:eh.z.literal("computer_call"),id:eh.z.string(),status:eh.z.string()}),eh.z.object({type:eh.z.literal("file_search_call"),id:eh.z.string()}),eh.z.object({type:eh.z.literal("image_generation_call"),id:eh.z.string()}),eh.z.object({type:eh.z.literal("code_interpreter_call"),id:eh.z.string(),container_id:eh.z.string(),code:eh.z.string().nullable(),outputs:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("logs"),logs:eh.z.string()}),eh.z.object({type:eh.z.literal("image"),url:eh.z.string()})])).nullable(),status:eh.z.string()})])}),eh.z.object({type:eh.z.literal("response.output_item.done"),output_index:eh.z.number(),item:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("message"),id:eh.z.string()}),eh.z.object({type:eh.z.literal("reasoning"),id:eh.z.string(),encrypted_content:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("function_call"),id:eh.z.string(),call_id:eh.z.string(),name:eh.z.string(),arguments:eh.z.string(),status:eh.z.literal("completed")}),eh.z.object({type:eh.z.literal("code_interpreter_call"),id:eh.z.string(),code:eh.z.string().nullable(),container_id:eh.z.string(),outputs:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("logs"),logs:eh.z.string()}),eh.z.object({type:eh.z.literal("image"),url:eh.z.string()})])).nullable()}),eh.z.object({type:eh.z.literal("image_generation_call"),id:eh.z.string(),result:eh.z.string()}),eh.z.object({type:eh.z.literal("web_search_call"),id:eh.z.string(),status:eh.z.string(),action:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("search"),query:eh.z.string().nullish(),sources:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("url"),url:eh.z.string()}),eh.z.object({type:eh.z.literal("api"),name:eh.z.string()})])).nullish()}),eh.z.object({type:eh.z.literal("open_page"),url:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("find_in_page"),url:eh.z.string().nullish(),pattern:eh.z.string().nullish()})])}),eh.z.object({type:eh.z.literal("file_search_call"),id:eh.z.string(),queries:eh.z.array(eh.z.string()),results:eh.z.array(eh.z.object({attributes:eh.z.record(eh.z.string(),eh.z.unknown()),file_id:eh.z.string(),filename:eh.z.string(),score:eh.z.number(),text:eh.z.string()})).nullish()}),eh.z.object({type:eh.z.literal("local_shell_call"),id:eh.z.string(),call_id:eh.z.string(),action:eh.z.object({type:eh.z.literal("exec"),command:eh.z.array(eh.z.string()),timeout_ms:eh.z.number().optional(),user:eh.z.string().optional(),working_directory:eh.z.string().optional(),env:eh.z.record(eh.z.string(),eh.z.string()).optional()})}),eh.z.object({type:eh.z.literal("computer_call"),id:eh.z.string(),status:eh.z.literal("completed")})])}),eh.z.object({type:eh.z.literal("response.function_call_arguments.delta"),item_id:eh.z.string(),output_index:eh.z.number(),delta:eh.z.string()}),eh.z.object({type:eh.z.literal("response.image_generation_call.partial_image"),item_id:eh.z.string(),output_index:eh.z.number(),partial_image_b64:eh.z.string()}),eh.z.object({type:eh.z.literal("response.code_interpreter_call_code.delta"),item_id:eh.z.string(),output_index:eh.z.number(),delta:eh.z.string()}),eh.z.object({type:eh.z.literal("response.code_interpreter_call_code.done"),item_id:eh.z.string(),output_index:eh.z.number(),code:eh.z.string()}),eh.z.object({type:eh.z.literal("response.output_text.annotation.added"),annotation:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("url_citation"),start_index:eh.z.number(),end_index:eh.z.number(),url:eh.z.string(),title:eh.z.string()}),eh.z.object({type:eh.z.literal("file_citation"),file_id:eh.z.string(),filename:eh.z.string().nullish(),index:eh.z.number().nullish(),start_index:eh.z.number().nullish(),end_index:eh.z.number().nullish(),quote:eh.z.string().nullish()})])}),eh.z.object({type:eh.z.literal("response.reasoning_summary_part.added"),item_id:eh.z.string(),summary_index:eh.z.number()}),eh.z.object({type:eh.z.literal("response.reasoning_summary_text.delta"),item_id:eh.z.string(),summary_index:eh.z.number(),delta:eh.z.string()}),eh.z.object({type:eh.z.literal("response.reasoning_summary_part.done"),item_id:eh.z.string(),summary_index:eh.z.number()}),eh.z.object({type:eh.z.literal("error"),sequence_number:eh.z.number(),error:eh.z.object({type:eh.z.string(),code:eh.z.string(),message:eh.z.string(),param:eh.z.string().nullish()})}),eh.z.object({type:eh.z.string()}).loose().transform(e=>({type:"unknown_chunk",message:e.type}))]))),e6=w(()=>el(eh.z.object({id:eh.z.string().optional(),created_at:eh.z.number().optional(),error:eh.z.object({message:eh.z.string(),type:eh.z.string(),param:eh.z.string().nullish(),code:eh.z.string()}).nullish(),model:eh.z.string().optional(),output:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("message"),role:eh.z.literal("assistant"),id:eh.z.string(),content:eh.z.array(eh.z.object({type:eh.z.literal("output_text"),text:eh.z.string(),logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number(),top_logprobs:eh.z.array(eh.z.object({token:eh.z.string(),logprob:eh.z.number()}))})).nullish(),annotations:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("url_citation"),start_index:eh.z.number(),end_index:eh.z.number(),url:eh.z.string(),title:eh.z.string()}),eh.z.object({type:eh.z.literal("file_citation"),file_id:eh.z.string(),filename:eh.z.string().nullish(),index:eh.z.number().nullish(),start_index:eh.z.number().nullish(),end_index:eh.z.number().nullish(),quote:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("container_file_citation"),container_id:eh.z.string(),file_id:eh.z.string(),filename:eh.z.string().nullish(),start_index:eh.z.number().nullish(),end_index:eh.z.number().nullish(),index:eh.z.number().nullish()}),eh.z.object({type:eh.z.literal("file_path"),file_id:eh.z.string(),index:eh.z.number().nullish()})]))}))}),eh.z.object({type:eh.z.literal("web_search_call"),id:eh.z.string(),status:eh.z.string(),action:eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("search"),query:eh.z.string().nullish(),sources:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("url"),url:eh.z.string()}),eh.z.object({type:eh.z.literal("api"),name:eh.z.string()})])).nullish()}),eh.z.object({type:eh.z.literal("open_page"),url:eh.z.string().nullish()}),eh.z.object({type:eh.z.literal("find_in_page"),url:eh.z.string().nullish(),pattern:eh.z.string().nullish()})])}),eh.z.object({type:eh.z.literal("file_search_call"),id:eh.z.string(),queries:eh.z.array(eh.z.string()),results:eh.z.array(eh.z.object({attributes:eh.z.record(eh.z.string(),eh.z.union([eh.z.string(),eh.z.number(),eh.z.boolean()])),file_id:eh.z.string(),filename:eh.z.string(),score:eh.z.number(),text:eh.z.string()})).nullish()}),eh.z.object({type:eh.z.literal("code_interpreter_call"),id:eh.z.string(),code:eh.z.string().nullable(),container_id:eh.z.string(),outputs:eh.z.array(eh.z.discriminatedUnion("type",[eh.z.object({type:eh.z.literal("logs"),logs:eh.z.string()}),eh.z.object({type:eh.z.literal("image"),url:eh.z.string()})])).nullable()}),eh.z.object({type:eh.z.literal("image_generation_call"),id:eh.z.string(),result:eh.z.string()}),eh.z.object({type:eh.z.literal("local_shell_call"),id:eh.z.string(),call_id:eh.z.string(),action:eh.z.object({type:eh.z.literal("exec"),command:eh.z.array(eh.z.string()),timeout_ms:eh.z.number().optional(),user:eh.z.string().optional(),working_directory:eh.z.string().optional(),env:eh.z.record(eh.z.string(),eh.z.string()).optional()})}),eh.z.object({type:eh.z.literal("function_call"),call_id:eh.z.string(),name:eh.z.string(),arguments:eh.z.string(),id:eh.z.string()}),eh.z.object({type:eh.z.literal("computer_call"),id:eh.z.string(),status:eh.z.string().optional()}),eh.z.object({type:eh.z.literal("reasoning"),id:eh.z.string(),encrypted_content:eh.z.string().nullish(),summary:eh.z.array(eh.z.object({type:eh.z.literal("summary_text"),text:eh.z.string()}))})])).optional(),service_tier:eh.z.string().nullish(),incomplete_details:eh.z.object({reason:eh.z.string()}).nullish(),usage:eh.z.object({input_tokens:eh.z.number(),input_tokens_details:eh.z.object({cached_tokens:eh.z.number().nullish()}).nullish(),output_tokens:eh.z.number(),output_tokens_details:eh.z.object({reasoning_tokens:eh.z.number().nullish()}).nullish()}).optional()}))),e8=w(()=>el(eh.z.object({conversation:eh.z.string().nullish(),include:eh.z.array(eh.z.enum(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:eh.z.string().nullish(),logprobs:eh.z.union([eh.z.boolean(),eh.z.number().min(1).max(20)]).optional(),maxToolCalls:eh.z.number().nullish(),metadata:eh.z.any().nullish(),parallelToolCalls:eh.z.boolean().nullish(),previousResponseId:eh.z.string().nullish(),promptCacheKey:eh.z.string().nullish(),promptCacheRetention:eh.z.enum(["in_memory","24h"]).nullish(),reasoningEffort:eh.z.string().nullish(),reasoningSummary:eh.z.string().nullish(),safetyIdentifier:eh.z.string().nullish(),serviceTier:eh.z.enum(["auto","flex","priority","default"]).nullish(),store:eh.z.boolean().nullish(),strictJsonSchema:eh.z.boolean().nullish(),textVerbosity:eh.z.enum(["low","medium","high"]).nullish(),truncation:eh.z.enum(["auto","disabled"]).nullish(),user:eh.z.string().nullish()})));async function e7({tools:e,toolChoice:t,strictJsonSchema:n}){e=(null==e?void 0:e.length)?e:void 0;let r=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:r};let i=[];for(let t of e)switch(t.type){case"function":i.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,strict:n});break;case"provider-defined":switch(t.id){case"openai.file_search":{let e=await k({value:t.args,schema:eV});i.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case"openai.local_shell":i.push({type:"local_shell"});break;case"openai.web_search_preview":{let e=await k({value:t.args,schema:e0});i.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.web_search":{let e=await k({value:t.args,schema:eQ});i.push({type:"web_search",filters:null!=e.filters?{allowed_domains:e.filters.allowedDomains}:void 0,external_web_access:e.externalWebAccess,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.code_interpreter":{let e=await k({value:t.args,schema:eM});i.push({type:"code_interpreter",container:null==e.container?{type:"auto",file_ids:void 0}:"string"==typeof e.container?e.container:{type:"auto",file_ids:e.container.fileIds}});break}case"openai.image_generation":{let e=await k({value:t.args,schema:eJ});i.push({type:"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,size:e.size,quality:e.quality,moderation:e.moderation,output_format:e.outputFormat,output_compression:e.outputCompression})}}break;default:r.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:i,toolChoice:void 0,toolWarnings:r};let o=t.type;switch(o){case"auto":case"none":case"required":return{tools:i,toolChoice:o,toolWarnings:r};case"tool":return{tools:i,toolChoice:"code_interpreter"===t.toolName||"file_search"===t.toolName||"image_generation"===t.toolName||"web_search_preview"===t.toolName||"web_search"===t.toolName?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:r};default:throw new a.UnsupportedFunctionalityError({functionality:`tool choice type: ${o}`})}}var te=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:r,topK:i,presencePenalty:o,frequencyPenalty:a,seed:s,prompt:l,providerOptions:u,tools:d,toolChoice:p,responseFormat:c}){var m,g,h,y;let f=[],z=ez(this.modelId);null!=i&&f.push({type:"unsupported-setting",setting:"topK"}),null!=s&&f.push({type:"unsupported-setting",setting:"seed"}),null!=o&&f.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=a&&f.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=n&&f.push({type:"unsupported-setting",setting:"stopSequences"});let _=await T({provider:"openai",providerOptions:u,schema:e8});(null==_?void 0:_.conversation)&&(null==_?void 0:_.previousResponseId)&&f.push({type:"unsupported-setting",setting:"conversation",details:"conversation and previousResponseId cannot be used together"});let{input:b,warnings:v}=await e9({prompt:l,systemMessageMode:z.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:null==(m=null==_?void 0:_.store)||m,hasLocalShellTool:j("openai.local_shell")});f.push(...v);let w=null!=(g=null==_?void 0:_.strictJsonSchema)&&g,k=null==_?void 0:_.include;function x(e){null==k?k=[e]:k.includes(e)||(k=[...k,e])}function j(e){return(null==d?void 0:d.find(t=>"provider-defined"===t.type&&t.id===e))!=null}let I="number"==typeof(null==_?void 0:_.logprobs)?null==_?void 0:_.logprobs:(null==_?void 0:_.logprobs)===!0?20:void 0;I&&x("message.output_text.logprobs");let P=null==(h=null==d?void 0:d.find(e=>"provider-defined"===e.type&&("openai.web_search"===e.id||"openai.web_search_preview"===e.id)))?void 0:h.name;P&&x("web_search_call.action.sources"),j("openai.code_interpreter")&&x("code_interpreter_call.outputs");let S=null==_?void 0:_.store;!1===S&&z.isReasoningModel&&x("reasoning.encrypted_content");let E={model:this.modelId,input:b,temperature:t,top_p:r,max_output_tokens:e,...((null==c?void 0:c.type)==="json"||(null==_?void 0:_.textVerbosity))&&{text:{...(null==c?void 0:c.type)==="json"&&{format:null!=c.schema?{type:"json_schema",strict:w,name:null!=(y=c.name)?y:"response",description:c.description,schema:c.schema}:{type:"json_object"}},...(null==_?void 0:_.textVerbosity)&&{verbosity:_.textVerbosity}}},conversation:null==_?void 0:_.conversation,max_tool_calls:null==_?void 0:_.maxToolCalls,metadata:null==_?void 0:_.metadata,parallel_tool_calls:null==_?void 0:_.parallelToolCalls,previous_response_id:null==_?void 0:_.previousResponseId,store:S,user:null==_?void 0:_.user,instructions:null==_?void 0:_.instructions,service_tier:null==_?void 0:_.serviceTier,include:k,prompt_cache_key:null==_?void 0:_.promptCacheKey,prompt_cache_retention:null==_?void 0:_.promptCacheRetention,safety_identifier:null==_?void 0:_.safetyIdentifier,top_logprobs:I,truncation:null==_?void 0:_.truncation,...z.isReasoningModel&&((null==_?void 0:_.reasoningEffort)!=null||(null==_?void 0:_.reasoningSummary)!=null)&&{reasoning:{...(null==_?void 0:_.reasoningEffort)!=null&&{effort:_.reasoningEffort},...(null==_?void 0:_.reasoningSummary)!=null&&{summary:_.reasoningSummary}}}};z.isReasoningModel?(null==_?void 0:_.reasoningEffort)==="none"&&z.supportsNonReasoningParameters||(null!=E.temperature&&(E.temperature=void 0,f.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=E.top_p&&(E.top_p=void 0,f.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):((null==_?void 0:_.reasoningEffort)!=null&&f.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),(null==_?void 0:_.reasoningSummary)!=null&&f.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),(null==_?void 0:_.serviceTier)!=="flex"||z.supportsFlexProcessing||(f.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete E.service_tier),(null==_?void 0:_.serviceTier)!=="priority"||z.supportsPriorityProcessing||(f.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete E.service_tier);let{tools:C,toolChoice:q,toolWarnings:A}=await e7({tools:d,toolChoice:p,strictJsonSchema:w});return{webSearchToolName:P,args:{...E,tools:C,tool_choice:q},warnings:[...f,...A],store:S}}async doGenerate(e){var t,n,r,i,o,s,l,u,d,c,g,h,y,f,z,_,b,v,w,k,x,j,I,P,T,S,C,q;let{args:A,warnings:$,webSearchToolName:Z}=await this.getArgs(e),O=this.config.url({path:"/responses",modelId:this.modelId}),F=this.config.provider.replace(".responses",""),{responseHeaders:R,value:M,rawValue:U}=await E({url:O,headers:p(this.config.headers(),e.headers),body:A,failedResponseHandler:ef,successfulResponseHandler:N(e6),abortSignal:e.abortSignal,fetch:this.config.fetch});if(M.error)throw new a.APICallError({message:M.error.message,url:O,requestBodyValues:A,statusCode:400,responseHeaders:R,responseBody:U,isRetryable:!1});let K=[],L=[],V=!1;for(let a of M.output)switch(a.type){case"reasoning":for(let e of(0===a.summary.length&&a.summary.push({type:"summary_text",text:""}),a.summary))K.push({type:"reasoning",text:e.text,providerMetadata:{[F]:{itemId:a.id,reasoningEncryptedContent:null!=(t=a.encrypted_content)?t:null}}});break;case"image_generation_call":K.push({type:"tool-call",toolCallId:a.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),K.push({type:"tool-result",toolCallId:a.id,toolName:"image_generation",result:{result:a.result},providerExecuted:!0});break;case"local_shell_call":K.push({type:"tool-call",toolCallId:a.call_id,toolName:"local_shell",input:JSON.stringify({action:a.action}),providerMetadata:{[F]:{itemId:a.id}}});break;case"message":for(let t of a.content)for(let p of((null==(r=null==(n=e.providerOptions)?void 0:n.openai)?void 0:r.logprobs)&&t.logprobs&&L.push(t.logprobs),K.push({type:"text",text:t.text,providerMetadata:{[F]:{itemId:a.id}}}),t.annotations))"url_citation"===p.type?K.push({type:"source",sourceType:"url",id:null!=(s=null==(o=(i=this.config).generateId)?void 0:o.call(i))?s:m(),url:p.url,title:p.title}):"file_citation"===p.type?K.push({type:"source",sourceType:"document",id:null!=(d=null==(u=(l=this.config).generateId)?void 0:u.call(l))?d:m(),mediaType:"text/plain",title:null!=(g=null!=(c=p.quote)?c:p.filename)?g:"Document",filename:null!=(h=p.filename)?h:p.file_id,...p.file_id?{providerMetadata:{[F]:{fileId:p.file_id}}}:{}}):"container_file_citation"===p.type?K.push({type:"source",sourceType:"document",id:null!=(z=null==(f=(y=this.config).generateId)?void 0:f.call(y))?z:m(),mediaType:"text/plain",title:null!=(b=null!=(_=p.filename)?_:p.file_id)?b:"Document",filename:null!=(v=p.filename)?v:p.file_id,providerMetadata:{[F]:{fileId:p.file_id,containerId:p.container_id,...null!=p.index?{index:p.index}:{}}}}):"file_path"===p.type&&K.push({type:"source",sourceType:"document",id:null!=(x=null==(k=(w=this.config).generateId)?void 0:k.call(w))?x:m(),mediaType:"application/octet-stream",title:p.file_id,filename:p.file_id,providerMetadata:{[F]:{fileId:p.file_id,...null!=p.index?{index:p.index}:{}}}});break;case"function_call":V=!0,K.push({type:"tool-call",toolCallId:a.call_id,toolName:a.name,input:a.arguments,providerMetadata:{[F]:{itemId:a.id}}});break;case"web_search_call":K.push({type:"tool-call",toolCallId:a.id,toolName:null!=Z?Z:"web_search",input:JSON.stringify({}),providerExecuted:!0}),K.push({type:"tool-result",toolCallId:a.id,toolName:null!=Z?Z:"web_search",result:tn(a.action),providerExecuted:!0});break;case"computer_call":K.push({type:"tool-call",toolCallId:a.id,toolName:"computer_use",input:"",providerExecuted:!0}),K.push({type:"tool-result",toolCallId:a.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:a.status||"completed"},providerExecuted:!0});break;case"file_search_call":K.push({type:"tool-call",toolCallId:a.id,toolName:"file_search",input:"{}",providerExecuted:!0}),K.push({type:"tool-result",toolCallId:a.id,toolName:"file_search",result:{queries:a.queries,results:null!=(I=null==(j=a.results)?void 0:j.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?I:null},providerExecuted:!0});break;case"code_interpreter_call":K.push({type:"tool-call",toolCallId:a.id,toolName:"code_interpreter",input:JSON.stringify({code:a.code,containerId:a.container_id}),providerExecuted:!0}),K.push({type:"tool-result",toolCallId:a.id,toolName:"code_interpreter",result:{outputs:a.outputs},providerExecuted:!0})}let D={[F]:{...null!=M.id?{responseId:M.id}:{}}};L.length>0&&(D[F].logprobs=L),"string"==typeof M.service_tier&&(D[F].serviceTier=M.service_tier);let B=M.usage;return{content:K,finishReason:e5({finishReason:null==(P=M.incomplete_details)?void 0:P.reason,hasFunctionCall:V}),usage:{inputTokens:B.input_tokens,outputTokens:B.output_tokens,totalTokens:B.input_tokens+B.output_tokens,reasoningTokens:null!=(S=null==(T=B.output_tokens_details)?void 0:T.reasoning_tokens)?S:void 0,cachedInputTokens:null!=(q=null==(C=B.input_tokens_details)?void 0:C.cached_tokens)?q:void 0},request:{body:A},response:{id:M.id,timestamp:new Date(1e3*M.created_at),modelId:M.model,headers:R,body:U},providerMetadata:D,warnings:$}}async doStream(e){let t,{args:n,warnings:r,webSearchToolName:i,store:o}=await this.getArgs(e),{responseHeaders:a,value:s}=await E({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:{...n,stream:!0},failedResponseHandler:ef,successfulResponseHandler:$(e3),abortSignal:e.abortSignal,fetch:this.config.fetch}),l=this,u=this.config.provider.replace(".responses",""),d="unknown",c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},g=[],h=null,y={},f=[],z=!1,_={};return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:r})},transform(n,r){var a,s,p,b,v,w,k,x,j,I,P,T,S,E,C,q,A,$,N,Z,O,F,R;if(e.includeRawChunks&&r.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){d="error",r.enqueue({type:"error",error:n.error});return}let M=n.value;if(tt(M))"function_call"===M.item.type?(y[M.output_index]={toolName:M.item.name,toolCallId:M.item.call_id},r.enqueue({type:"tool-input-start",id:M.item.call_id,toolName:M.item.name})):"web_search_call"===M.item.type?(y[M.output_index]={toolName:null!=i?i:"web_search",toolCallId:M.item.id},r.enqueue({type:"tool-input-start",id:M.item.id,toolName:null!=i?i:"web_search",providerExecuted:!0}),r.enqueue({type:"tool-input-end",id:M.item.id}),r.enqueue({type:"tool-call",toolCallId:M.item.id,toolName:null!=i?i:"web_search",input:JSON.stringify({}),providerExecuted:!0})):"computer_call"===M.item.type?(y[M.output_index]={toolName:"computer_use",toolCallId:M.item.id},r.enqueue({type:"tool-input-start",id:M.item.id,toolName:"computer_use",providerExecuted:!0})):"code_interpreter_call"===M.item.type?(y[M.output_index]={toolName:"code_interpreter",toolCallId:M.item.id,codeInterpreter:{containerId:M.item.container_id}},r.enqueue({type:"tool-input-start",id:M.item.id,toolName:"code_interpreter",providerExecuted:!0}),r.enqueue({type:"tool-input-delta",id:M.item.id,delta:`{"containerId":"${M.item.container_id}","code":"`})):"file_search_call"===M.item.type?r.enqueue({type:"tool-call",toolCallId:M.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):"image_generation_call"===M.item.type?r.enqueue({type:"tool-call",toolCallId:M.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):"message"===M.item.type?(f.splice(0,f.length),r.enqueue({type:"text-start",id:M.item.id,providerMetadata:{[u]:{itemId:M.item.id}}})):tt(M)&&"reasoning"===M.item.type&&(_[M.item.id]={encryptedContent:M.item.encrypted_content,summaryParts:{0:"active"}},r.enqueue({type:"reasoning-start",id:`${M.item.id}:0`,providerMetadata:{[u]:{itemId:M.item.id,reasoningEncryptedContent:null!=(a=M.item.encrypted_content)?a:null}}}));else if("response.output_item.done"===M.type){if("message"===M.item.type)r.enqueue({type:"text-end",id:M.item.id,providerMetadata:{[u]:{itemId:M.item.id,...f.length>0&&{annotations:f}}}});else if("function_call"===M.item.type)y[M.output_index]=void 0,z=!0,r.enqueue({type:"tool-input-end",id:M.item.call_id}),r.enqueue({type:"tool-call",toolCallId:M.item.call_id,toolName:M.item.name,input:M.item.arguments,providerMetadata:{[u]:{itemId:M.item.id}}});else if("web_search_call"===M.item.type)y[M.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:M.item.id,toolName:null!=i?i:"web_search",result:tn(M.item.action),providerExecuted:!0});else if("computer_call"===M.item.type)y[M.output_index]=void 0,r.enqueue({type:"tool-input-end",id:M.item.id}),r.enqueue({type:"tool-call",toolCallId:M.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),r.enqueue({type:"tool-result",toolCallId:M.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:M.item.status||"completed"},providerExecuted:!0});else if("file_search_call"===M.item.type)y[M.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:M.item.id,toolName:"file_search",result:{queries:M.item.queries,results:null!=(p=null==(s=M.item.results)?void 0:s.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?p:null},providerExecuted:!0});else if("code_interpreter_call"===M.item.type)y[M.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:M.item.id,toolName:"code_interpreter",result:{outputs:M.item.outputs},providerExecuted:!0});else if("image_generation_call"===M.item.type)r.enqueue({type:"tool-result",toolCallId:M.item.id,toolName:"image_generation",result:{result:M.item.result},providerExecuted:!0});else if("local_shell_call"===M.item.type)y[M.output_index]=void 0,r.enqueue({type:"tool-call",toolCallId:M.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:M.item.action.command,timeoutMs:M.item.action.timeout_ms,user:M.item.action.user,workingDirectory:M.item.action.working_directory,env:M.item.action.env}}),providerMetadata:{[u]:{itemId:M.item.id}}});else if("reasoning"===M.item.type){for(let e of Object.entries(_[M.item.id].summaryParts).filter(([e,t])=>"active"===t||"can-conclude"===t).map(([e])=>e))r.enqueue({type:"reasoning-end",id:`${M.item.id}:${e}`,providerMetadata:{[u]:{itemId:M.item.id,reasoningEncryptedContent:null!=(b=M.item.encrypted_content)?b:null}}});delete _[M.item.id]}}else if("response.function_call_arguments.delta"===M.type){let e=y[M.output_index];null!=e&&r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:M.delta})}else if("response.code_interpreter_call_code.delta"===M.type){let e=y[M.output_index];null!=e&&r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:JSON.stringify(M.delta).slice(1,-1)})}else if("response.code_interpreter_call_code.done"===M.type){let e=y[M.output_index];null!=e&&(r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}'}),r.enqueue({type:"tool-input-end",id:e.toolCallId}),r.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:M.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else if("response.created"===M.type)h=M.response.id,r.enqueue({type:"response-metadata",id:M.response.id,timestamp:new Date(1e3*M.response.created_at),modelId:M.response.model});else if("response.output_text.delta"===M.type)r.enqueue({type:"text-delta",id:M.item_id,delta:M.delta}),(null==(w=null==(v=e.providerOptions)?void 0:v.openai)?void 0:w.logprobs)&&M.logprobs&&g.push(M.logprobs);else if("response.reasoning_summary_part.added"===M.type){if(M.summary_index>0){let e=_[M.item_id];for(let t of(e.summaryParts[M.summary_index]="active",Object.keys(e.summaryParts)))"can-conclude"===e.summaryParts[t]&&(r.enqueue({type:"reasoning-end",id:`${M.item_id}:${t}`,providerMetadata:{[u]:{itemId:M.item_id}}}),e.summaryParts[t]="concluded");r.enqueue({type:"reasoning-start",id:`${M.item_id}:${M.summary_index}`,providerMetadata:{[u]:{itemId:M.item_id,reasoningEncryptedContent:null!=(x=null==(k=_[M.item_id])?void 0:k.encryptedContent)?x:null}}})}}else{"response.reasoning_summary_text.delta"===M.type?r.enqueue({type:"reasoning-delta",id:`${M.item_id}:${M.summary_index}`,delta:M.delta,providerMetadata:{[u]:{itemId:M.item_id}}}):"response.reasoning_summary_part.done"===M.type?o?(r.enqueue({type:"reasoning-end",id:`${M.item_id}:${M.summary_index}`,providerMetadata:{[u]:{itemId:M.item_id}}}),_[M.item_id].summaryParts[M.summary_index]="concluded"):_[M.item_id].summaryParts[M.summary_index]="can-conclude":"response.completed"===(R=M).type||"response.incomplete"===R.type?(d=e5({finishReason:null==(j=M.response.incomplete_details)?void 0:j.reason,hasFunctionCall:z}),c.inputTokens=M.response.usage.input_tokens,c.outputTokens=M.response.usage.output_tokens,c.totalTokens=M.response.usage.input_tokens+M.response.usage.output_tokens,c.reasoningTokens=null!=(P=null==(I=M.response.usage.output_tokens_details)?void 0:I.reasoning_tokens)?P:void 0,c.cachedInputTokens=null!=(S=null==(T=M.response.usage.input_tokens_details)?void 0:T.cached_tokens)?S:void 0,"string"==typeof M.response.service_tier&&(t=M.response.service_tier)):"response.output_text.annotation.added"===M.type?(f.push(M.annotation),"url_citation"===M.annotation.type?r.enqueue({type:"source",sourceType:"url",id:null!=(q=null==(C=(E=l.config).generateId)?void 0:C.call(E))?q:m(),url:M.annotation.url,title:M.annotation.title}):"file_citation"===M.annotation.type&&r.enqueue({type:"source",sourceType:"document",id:null!=(N=null==($=(A=l.config).generateId)?void 0:$.call(A))?N:m(),mediaType:"text/plain",title:null!=(O=null!=(Z=M.annotation.quote)?Z:M.annotation.filename)?O:"Document",filename:null!=(F=M.annotation.filename)?F:M.annotation.file_id,...M.annotation.file_id?{providerMetadata:{[u]:{fileId:M.annotation.file_id}}}:{}})):"error"===M.type&&r.enqueue({type:"error",error:M})}},flush(e){let n={[u]:{responseId:h}};g.length>0&&(n[u].logprobs=g),void 0!==t&&(n[u].serviceTier=t),e.enqueue({type:"finish",finishReason:d,usage:c,providerMetadata:n})}})),request:{body:n},response:{headers:a}}}};function tt(e){return"response.output_item.added"===e.type}function tn(e){var t;switch(e.type){case"search":return{action:{type:"search",query:null!=(t=e.query)?t:void 0},...null!=e.sources&&{sources:e.sources}};case"open_page":return{action:{type:"openPage",url:e.url}};case"find_in_page":return{action:{type:"findInPage",url:e.url,pattern:e.pattern}}}}var tr=w(()=>el(eh.z.object({instructions:eh.z.string().nullish(),speed:eh.z.number().min(.25).max(4).default(1).nullish()}))),ti=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:r,instructions:i,language:o,providerOptions:a}){let s=[],l=await T({provider:"openai",providerOptions:a,schema:tr}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:r,instructions:i};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?u.response_format=n:s.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),l){let e={};for(let t in e){let n=e[t];void 0!==n&&(u[t]=n)}}return o&&s.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${o}" was ignored.`}),{requestBody:u,warnings:s}}async doGenerate(e){var t,n,r;let i=null!=(r=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?r:new Date,{requestBody:o,warnings:s}=await this.getArgs(e),{value:l,responseHeaders:u,rawValue:d}=await E({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),body:o,failedResponseHandler:ef,successfulResponseHandler:async({response:e,url:t,requestBodyValues:n})=>{let r=c(e);if(!e.body)throw new a.APICallError({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:r,value:new Uint8Array(t)}}catch(i){throw new a.APICallError({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:r,responseBody:void 0,cause:i})}},abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:l,warnings:s,request:{body:JSON.stringify(o)},response:{timestamp:i,modelId:this.modelId,headers:u,body:d}}}},to=w(()=>el(eh.z.object({text:eh.z.string(),language:eh.z.string().nullish(),duration:eh.z.number().nullish(),words:eh.z.array(eh.z.object({word:eh.z.string(),start:eh.z.number(),end:eh.z.number()})).nullish(),segments:eh.z.array(eh.z.object({id:eh.z.number(),seek:eh.z.number(),start:eh.z.number(),end:eh.z.number(),text:eh.z.string(),tokens:eh.z.array(eh.z.number()),temperature:eh.z.number(),avg_logprob:eh.z.number(),compression_ratio:eh.z.number(),no_speech_prob:eh.z.number()})).nullish()}))),ta=w(()=>el(eh.z.object({include:eh.z.array(eh.z.string()).optional(),language:eh.z.string().optional(),prompt:eh.z.string().optional(),temperature:eh.z.number().min(0).max(1).default(0).optional(),timestampGranularities:eh.z.array(eh.z.enum(["word","segment"])).default(["segment"]).optional()}))),ts={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},tl=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let r,i=await T({provider:"openai",providerOptions:n,schema:ta}),o=new FormData,a=e instanceof Uint8Array?new Blob([e]):new Blob([(r=em(e.replace(/-/g,"+").replace(/_/g,"/")),Uint8Array.from(r,e=>e.codePointAt(0)))]);o.append("model",this.modelId);let s=function(e){var t;let[n,r=""]=e.toLowerCase().split("/");return null!=(t=({mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"})[r])?t:r}(t);if(o.append("file",new File([a],"audio",{type:t}),`audio.${s}`),i){for(let[e,t]of Object.entries({include:i.include,language:i.language,prompt:i.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:i.temperature,timestamp_granularities:i.timestampGranularities}))if(null!=t)if(Array.isArray(t))for(let n of t)o.append(`${e}[]`,String(n));else o.append(e,String(t))}return{formData:o,warnings:[]}}async doGenerate(e){var t,n,r,i,o,a,s,l;let u=null!=(r=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?r:new Date,{formData:d,warnings:c}=await this.getArgs(e),{value:m,responseHeaders:g,rawValue:h}=await C({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:p(this.config.headers(),e.headers),formData:d,failedResponseHandler:ef,successfulResponseHandler:N(to),abortSignal:e.abortSignal,fetch:this.config.fetch}),y=null!=m.language&&m.language in ts?ts[m.language]:void 0;return{text:m.text,segments:null!=(s=null!=(a=null==(i=m.segments)?void 0:i.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))?a:null==(o=m.words)?void 0:o.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?s:[],language:y,durationInSeconds:null!=(l=m.duration)?l:void 0,warnings:c,response:{timestamp:u,modelId:this.modelId,headers:g,body:h}}}};function tu(e={}){var t,n,r;let i=null!=(t=null==(r=function({settingValue:e,environmentVariableName:t}){return"string"==typeof e?e:null!=e||"undefined"==typeof process?void 0:null!=(e=process.env[t])&&"string"==typeof e?e:void 0}({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"}))?void 0:r.replace(/\/$/,""))?t:"https://api.openai.com/v1",o=null!=(n=e.name)?n:"openai",s=()=>y({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new a.LoadAPIKeyError({message:`${r} API key must be a string.`});if("undefined"==typeof process)throw new a.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new a.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new a.LoadAPIKeyError({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},"ai-sdk/openai/2.0.88"),l=t=>new eA(t,{provider:`${o}.embedding`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),u=t=>new eO(t,{provider:`${o}.image`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),d=t=>new tl(t,{provider:`${o}.transcription`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),p=t=>new ti(t,{provider:`${o}.speech`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),c=e=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return m(e)},m=t=>new te(t,{provider:`${o}.responses`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch,fileIdPrefixes:["file-"]}),g=function(e){return c(e)};return g.languageModel=c,g.chat=t=>new ex(t,{provider:`${o}.chat`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),g.completion=t=>new eE(t,{provider:`${o}.completion`,url:({path:e})=>`${i}${e}`,headers:s,fetch:e.fetch}),g.responses=m,g.embedding=l,g.textEmbedding=l,g.textEmbeddingModel=l,g.image=u,g.imageModel=u,g.transcription=d,g.transcriptionModel=d,g.speech=p,g.speechModel=p,g.tools=e1,g}tu();let td=tu({baseURL:"https://api.deepseek.com",apiKey:process.env.DEEPSEEK_API_KEY})("deepseek-chat");e.s(["deepseekModel",0,td],71370)}];

//# sourceMappingURL=Kryptotrac-xx-1_lib_atlas_rate-limiter_ts_4390b3b6._.js.map