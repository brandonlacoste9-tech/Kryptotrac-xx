module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},83664,(e,t,r)=>{"use strict";var a=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,s={},l={VercelOidcTokenError:()=>c};for(var d in l)a(s,d,{get:l[d],enumerable:!0});t.exports=((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of o(t))n.call(e,r)||void 0===r||a(e,r,{get:()=>t[r],enumerable:!(s=i(t,r))||s.enumerable});return e})(a({},"__esModule",{value:!0}),s);class c extends Error{constructor(e,t){super(e),this.name="VercelOidcTokenError",this.cause=t}toString(){return this.cause?`${this.name}: ${this.message}: ${this.cause}`:`${this.name}: ${this.message}`}}},38636,e=>{"use strict";let t=process.env.COINGECKO_API_KEY||"",r=new Map;async function a(e){let a,i=`price-${e}`,o=(a=r.get(i))&&Date.now()-a.timestamp<6e4?a.data:null;if(o)return o;try{let a,o=await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${e}&vs_currencies=usd`,{headers:(a={Accept:"application/json"},t&&(a["x-cg-pro-api-key"]=t),a)});if(!o.ok)throw Error("Failed to fetch price");let n=await o.json(),s=n[e]?.usd||0;return r.set(i,{data:s,timestamp:Date.now()}),s}catch(e){throw console.error("[v0] CoinGecko price error:",e),e}}e.s(["getCoinPrice",()=>a])},20220,e=>{"use strict";var t=e.i(85625),r=e.i(64296),a=e.i(44397),i=e.i(29438),o=e.i(60850),n=e.i(85968),s=e.i(41442),l=e.i(49323),d=e.i(67576),c=e.i(25032),u=e.i(94944),p=e.i(90682),h=e.i(17435),f=e.i(57970),m=e.i(19531),v=e.i(45387),g=e.i(93695);e.i(29238);var x=e.i(25166),w=e.i(55786),y=e.i(44738);async function _(e,t=30){let r=await (0,y.createClient)(),{data:a,error:i}=await r.from("portfolio_snapshots").select("total_value, snapshot_date").eq("user_id",e).order("snapshot_date",{ascending:!0}).limit(t);if(i||!a||a.length<2)return[];let o=[];for(let e=1;e<a.length;e++){let t=a[e-1].total_value,r=(a[e].total_value-t)/t;o.push(r)}return o}async function R(e,t=90){let r=await (0,y.createClient)(),{data:a,error:i}=await r.from("portfolio_snapshots").select("total_value, snapshot_date").eq("user_id",e).order("snapshot_date",{ascending:!0}).limit(t);return i||!a?[]:a.map(e=>({date:e.snapshot_date,value:Number(e.total_value)}))}async function b(t){let{calculateSharpeRatio:r,calculateVolatility:a,calculateMaxDrawdown:i,calculateDiversificationScore:o,calculateRiskScore:n}=await e.A(20348),s=await _(t,30),l=(await R(t,90)).map(e=>e.value);if(s.length<2||l.length<2)return null;let d=r(s),c=a(s),u=i(l),p=await (0,y.createClient)(),{data:h}=await p.from("user_portfolios").select("*, current_value:quantity").eq("user_id",t).gt("quantity",0),f=h?o(h):0,m=n(c,u);return{sharpeRatio:d,volatility:c,maxDrawdown:u,diversificationScore:f,riskScore:m}}var C=e.i(45355);async function E(e,t,r,a,i){let o=r-a,n=e.sort((e,t)=>t.current_value-e.current_value).slice(0,10).map(e=>`${e.coin_name} (${e.coin_symbol.toUpperCase()}): $${e.current_value.toFixed(2)} (${e.profit_loss_percentage>=0?"+":""}${e.profit_loss_percentage.toFixed(2)}%)`).join("\n"),s=`You are a professional crypto investment analyst. Analyze this portfolio and provide actionable insights.

Portfolio Overview:
- Total Value: $${r.toFixed(2)}
- Total Cost Basis: $${o.toFixed(2)}
- Total P&L: $${a.toFixed(2)} (${i>=0?"+":""}${i.toFixed(2)}%)
- Number of Holdings: ${e.length}

Performance Metrics:
- Sharpe Ratio: ${t.sharpeRatio.toFixed(2)}
- Volatility (Annualized): ${t.volatility.toFixed(2)}%
- Max Drawdown: ${t.maxDrawdown.toFixed(2)}%
- Diversification Score: ${t.diversificationScore.toFixed(0)}/100
- Risk Score: ${t.riskScore.toFixed(0)}/100

Top Holdings:
${n}

Provide a comprehensive analysis in JSON format with these fields:
{
  "summary": "2-3 sentence overall portfolio summary",
  "riskAssessment": "Detailed risk assessment based on volatility, drawdown, and diversification",
  "recommendations": ["3-5 specific actionable recommendations"],
  "diversificationAdvice": "Specific advice on improving diversification",
  "performanceCommentary": "Analysis of current performance and trends",
  "trends": ["2-3 key trends or patterns identified"]
}

Be specific, data-driven, and actionable. Focus on practical advice.`;try{let{text:e}=await (0,C.generateText)({model:"openai/gpt-4o-mini",prompt:s,temperature:.7,maxTokens:1e3}),t=e.match(/\{[\s\S]*\}/);if(!t)throw Error("Invalid response format");return JSON.parse(t[0])}catch(a){return console.error("[v0] Error generating AI insights:",a),{summary:`Your portfolio of ${e.length} cryptocurrencies has a total value of $${r.toFixed(2)} with a ${i>=0?"gain":"loss"} of ${Math.abs(i).toFixed(2)}%.`,riskAssessment:`Your portfolio shows ${t.riskScore>70?"high":t.riskScore>40?"moderate":"low"} risk with ${t.volatility.toFixed(0)}% annualized volatility.`,recommendations:[t.diversificationScore<50?"Consider increasing diversification by adding more holdings":"Maintain your current diversification level",t.maxDrawdown>30?"Review stop-loss strategies to limit downside risk":"Continue monitoring positions","Regularly rebalance your portfolio to maintain target allocations"],diversificationAdvice:t.diversificationScore<50?"Your portfolio concentration is relatively high. Consider spreading investments across more assets.":"Your portfolio shows good diversification across multiple holdings.",performanceCommentary:`Overall performance is ${i>=0?"positive":"negative"} with a ${Math.abs(i).toFixed(2)}% ${i>=0?"gain":"loss"}.`,trends:[i>0?"Portfolio showing positive returns":"Portfolio experiencing drawdown",`Sharpe ratio of ${t.sharpeRatio.toFixed(2)} indicates ${t.sharpeRatio>1?"good":t.sharpeRatio>.5?"moderate":"poor"} risk-adjusted returns`]}}}var $=e.i(38636);async function k(){try{let e=await (0,y.createServerClient)(),{data:{user:t}}=await e.auth.getUser();if(!t)return w.NextResponse.json({error:"Unauthorized"},{status:401});let{data:r}=await e.from("user_subscriptions").select("plan_type, status").eq("user_id",t.id).eq("status","active").single();if(!r||"pro"!==r.plan_type)return w.NextResponse.json({error:"Pro subscription required"},{status:403});let{data:a,error:i}=await e.from("user_portfolios").select("*").eq("user_id",t.id).gt("quantity",0);if(i||!a||0===a.length)return w.NextResponse.json({error:"No holdings found"},{status:404});let o=await Promise.all(a.map(async e=>{let t=await (0,$.getCoinPrice)(e.coin_id),r=Number(e.quantity)*t,a=Number(e.quantity)*Number(e.purchase_price),i=r-a;return{coin_name:e.coin_name,coin_symbol:e.coin_symbol,current_value:r,profit_loss:i,profit_loss_percentage:i/a*100}})),n=await b(t.id);if(!n)return w.NextResponse.json({error:"Unable to calculate metrics"},{status:500});let s=o.reduce((e,t)=>e+t.current_value,0),l=o.reduce((e,t)=>e+t.profit_loss,0),d=await E(o,n,s,l,s>0?l/(s-l)*100:0),{error:c}=await e.from("insights_history").insert({user_id:t.id,insights:d,metrics:n,generated_at:new Date().toISOString()});c&&console.error("[v0] Error saving insights:",c);let{data:u}=await e.from("insights_history").select("id, generated_at").eq("user_id",t.id).order("generated_at",{ascending:!1});if(u&&u.length>30){let r=u.slice(30).map(e=>e.id);await e.from("insights_history").delete().in("id",r),console.log(`[v0] Cleaned up ${r.length} old insights for user ${t.id}`)}return w.NextResponse.json({insights:d,metrics:n})}catch(e){return console.error("[v0] Error generating insights:",e),w.NextResponse.json({error:"Failed to generate insights"},{status:500})}}e.s(["POST",()=>k],88504);var P=e.i(88504);let A=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/insights/generate/route",pathname:"/api/insights/generate",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Kryptotrac-xx-1/app/api/insights/generate/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:N,workUnitAsyncStorage:S,serverHooks:O}=A;function j(){return(0,a.patchFetch)({workAsyncStorage:N,workUnitAsyncStorage:S})}async function T(e,t,a){A.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/insights/generate/route";w=w.replace(/\/index$/,"")||"/";let y=await A.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:_,params:R,nextConfig:b,parsedUrl:C,isDraftMode:E,prerenderManifest:$,routerServerContext:k,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,resolvedPathname:S,clientReferenceManifest:O,serverActionsManifest:j}=y,T=(0,l.normalizeAppPath)(w),q=!!($.dynamicRoutes[T]||$.routes[S]),F=async()=>((null==k?void 0:k.render404)?await k.render404(e,t,C,!1):t.end("This page could not be found"),null);if(q&&!E){let e=!!$.routes[S],t=$.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(b.experimental.adapterPath)return await F();throw new g.NoFallbackError}}let M=null;!q||A.isDev||E||(M="/index"===(M=S)?"/":M);let D=!0===A.isDev||!q,I=q&&!D;j&&O&&(0,n.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:O,serverActionsManifest:j,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:j})});let U=e.method||"GET",H=(0,o.getTracer)(),K=H.getActiveScopeSpan(),B={params:R,prerenderManifest:$,renderOpts:{experimental:{authInterrupts:!!b.experimental.authInterrupts},cacheComponents:!!b.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:b.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>A.onRequestError(e,t,a,k)},sharedContext:{buildId:_}},V=new d.NodeNextRequest(e),L=new d.NodeNextResponse(t),Y=c.NextRequestAdapter.fromNodeNextRequest(V,(0,c.signalFromNodeResponse)(t));try{let n=async e=>A.handle(Y,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${U} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${w}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&P&&N&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await n(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(V,L,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:x.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await A.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:P})},k),t}},c=await A.handleResponse({req:e,nextConfig:b,cacheKey:M,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:N,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!q)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==x.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",P?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&q||u.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(V,L,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};K?await l(K):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${U} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await A.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:I,isOnDemandRevalidate:P})}),q)throw t;return await (0,h.sendResponse)(V,L,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>j,"routeModule",()=>A,"serverHooks",()=>O,"workAsyncStorage",()=>N,"workUnitAsyncStorage",()=>S],20220)},20348,e=>{e.v(t=>Promise.all(["server/chunks/Kryptotrac-xx-1_lib_analytics_ts_ece4472d._.js"].map(t=>e.l(t))).then(()=>t(97157)))},41868,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__1cc96b3a._.js"].map(t=>e.l(t))).then(()=>t(76784)))},1622,e=>{e.v(t=>Promise.all(["server/chunks/[root-of-the-server]__87a5fe02._.js"].map(t=>e.l(t))).then(()=>t(92650)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__abfa8789._.js.map